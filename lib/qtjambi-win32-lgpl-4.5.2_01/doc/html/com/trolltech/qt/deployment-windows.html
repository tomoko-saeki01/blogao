<?xml version="1.0" encoding="iso-8859-1"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
<title>Deploying an Application on Windows</title><link href="classic.css" rel="stylesheet" type="text/css" />
</head><table border="0" cellpadding="0" cellspacing="0" width="100%">
 <tr>
 <td align="left" valign="top" width="32"> <img src="images/qt-logo.png" align="left" width="32" height="32" border="0" /> </td>
 <td width="1">&nbsp;&nbsp;</td> <td class="postheader" valign="center"> <a href="qtjambi-index.html"> <font color="#004faf">Home</font></a>&nbsp;&middot; <a href="qtjambi-examples.html"> <font color="#004faf">Examples</font></a>&nbsp; </td>
 </tr></table><body><p><hr><p><center><h1>Deploying an Application on Windows</h1></center><p>[<a href="deployment.html">Deploying Qt Applications</a>]<p> This documentation will describe how to determine which files you should include in your distribution, and how to make sure that the application will find them at run-time. We will demonstrate the procedures in terms of deploying the <a href="tools-plugandpaint.html">Plug & Paint</a> application that is provided in Qt's examples directory. <p>Contents: <ul><li> <a href="#static-linking">Static Linking</a></li> <ul><li> <a href="#building-qt-statically">Building Qt Statically</a></li><li> <a href="#linking-the-application-to-the-static-version-of-qt">Linking the Application to the Static Version of Qt</a></li></ul><li> <a href="#shared-libraries">Shared Libraries</a></li> <ul><li> <a href="#building-qt-as-a-shared-library">Building Qt as a Shared Library</a></li><li> <a href="#linking-the-application-to-qt-as-a-shared-library">Linking the Application to Qt as a Shared Library</a></li><li> <a href="#creating-the-application-package">Creating the Application Package</a></li><li> <a href="#visual-studio-2005-onwards">Visual Studio 2005 Onwards</a></li></ul><li> <a href="#application-dependencies">Application Dependencies</a></li> <ul><li> <a href="#additional-libraries">Additional Libraries</a></li><li> <a href="#qt-plugins">Qt Plugins</a></li></ul></ul><a name="static-linking"><h2>Static Linking</h2> If you want to keep things simple by only having a few files to deploy, i.e. a stand-alone executable with the associated compiler specific DLLs, then you must build everything statically.<a name="building-qt-statically"><h3>Building Qt Statically</h3> Before we can build our application we must make sure that Qt is built statically. To do this, go to a command prompt and type the following: <pre class="snippet">
cd C:\path\to\Qt
configure -static &lt;any other options you need&gt;
</pre> Remember to specify any other options you need, such as data base drivers, as arguments to <tt>configure</tt>. Once <tt>configure</tt> has finished, type the following: <pre class="snippet">
nmake sub-src
</pre> This will build Qt statically. Note that unlike with a dynamic build, building Qt statically will result in libraries without version numbers; e.g. <tt>QtCore4.lib</tt> will be <tt>QtCore.lib</tt>. Also, we have used <tt>nmake</tt> in all the examples, but if you use MinGW you must use <tt>mingw32-make</tt> instead. <p><b>Note:</b> If you later need to reconfigure and rebuild Qt from the same location, ensure that all traces of the previous configuration are removed by entering the build directory and typing <tt>nmake distclean</tt> before running <tt>configure</tt> again.<a name="linking-the-application-to-the-static-version-of-qt"><h3>Linking the Application to the Static Version of Qt</h3> Once Qt has finished building we can build the <a href="tools-plugandpaint.html">Plug & Paint</a> application. First we must go into the directory that contains the application: <pre class="snippet">
cd examples\tools\plugandpaint
</pre> We must then run <tt>qmake</tt> to create a new makefile for the application, and do a clean build to create the statically linked executable: <pre class="snippet">
nmake clean
qmake -config release
nmake
</pre> You probably want to link against the release libraries, and you can specify this when invoking <tt>qmake</tt>. Now, provided that everything compiled and linked without any errors, we should have a <tt>plugandpaint.exe</tt> file that is ready for deployment. One easy way to check that the application really can be run stand-alone is to copy it to a machine that doesn't have Qt or any Qt applications installed, and run it on that machine. <p>Remember that if your application depends on compiler specific libraries, these must still be redistributed along with your application. You can check which libraries your application is linking against by using the <tt>depends</tt> tool. For more information, see the Application Dependencies section. <p>The <a href="tools-plugandpaint.html">Plug & Paint</a> example consists of several components: The application itself (<a href="tools-plugandpaint.html">Plug & Paint</a>), and the <a href="tools-plugandpaintplugins-basictools.html">Basic Tools</a> and <a href="tools-plugandpaintplugins-extrafilters.html">Extra Filters</a> plugins. Since we cannot deploy plugins using the static linking approach, the application we have prepared is incomplete. It will run, but the functionality will be disabled due to the missing plugins. To deploy plugin-based applications we should use the shared library approach.<a name="shared-libraries"><h2>Shared Libraries</h2> We have two challenges when deploying the <a href="tools-plugandpaint.html">Plug & Paint</a> application using the shared libraries approach: The Qt runtime has to be correctly redistributed along with the application executable, and the plugins have to be installed in the correct location on the target system so that the application can find them.<a name="building-qt-as-a-shared-library"><h3>Building Qt as a Shared Library</h3> We assume that you already have installed Qt as a shared library, which is the default when installing Qt, in the <tt>C:\path\to\Qt</tt> directory. For more information on how to build Qt, see the <a href="installation.html">Installation</a> documentation.<a name="linking-the-application-to-qt-as-a-shared-library"><h3>Linking the Application to Qt as a Shared Library</h3> After ensuring that Qt is built as a shared library, we can build the <a href="tools-plugandpaint.html">Plug & Paint</a> application. First, we must go into the directory that contains the application: <pre class="snippet">
cd examples\tools\plugandpaint
</pre> Now run <tt>qmake</tt> to create a new makefile for the application, and do a clean build to create the dynamically linked executable: <pre class="snippet">
nmake clean
qmake -config release
nmake
</pre> This builds the core application, the following will build the plugins: <pre class="snippet">
cd ..\plugandpaintplugins
nmake clean
qmake -config release
nmake
</pre> If everything compiled and linked without any errors, we will get a <tt>plugandpaint.exe</tt> executable and the <tt>pnp_basictools.dll</tt> and <tt>pnp_extrafilters.dll</tt> plugin files.<a name="creating-the-application-package"><h3>Creating the Application Package</h3> To deploy the application, we must make sure that we copy the relevant Qt DLL (corresponding to the Qt modules used in the application) as well as the executable to the same directory in the <tt>release</tt> subdirectory. <p>Remember that if your application depends on compiler specific libraries, these must be redistributed along with your application. You can check which libraries your application is linking against by using the <tt>depends</tt> tool. For more information, see the Application Dependencies section. <p>We'll cover the plugins shortly, but first we'll check that the application will work in a deployed environment: Either copy the executable and the Qt DLLs to a machine that doesn't have Qt or any Qt applications installed, or if you want to test on the build machine, ensure that the machine doesn't have Qt in its environment. <p>If the application starts without any problems, then we have successfully made a dynamically linked version of the <a href="tools-plugandpaint.html">Plug & Paint</a> application. But the application's functionality will still be missing since we have not yet deployed the associated plugins. <p>Plugins work differently to normal DLLs, so we can't just copy them into the same directory as our application's executable as we did with the Qt DLLs. When looking for plugins, the application searches in a <tt>plugins</tt> subdirectory inside the directory of the application executable. <p>So to make the plugins available to our application, we have to create the <tt>plugins</tt> subdirectory and copy over the relevant DLLs: <pre class="snippet">
plugins\pnp_basictools.dll
plugins\pnp_extrafilters.dll
</pre> An archive distributing all the Qt DLLs and application specific plugins required to run the <a href="tools-plugandpaint.html">Plug & Paint</a> application, would have to include the following files: <table align="center" border="0" cellpadding="2" cellspacing="1" width="100%"><thead><tr class="qt-style" valign="top"><th><center> Component</center></th><th><center> File Name</center></th></tr></thead><tr valign="top" class="even"><td> The executable</td><td rowspan=1 colspan=2> <tt>plugandpaint.exe</tt></td></tr><tr valign="top" class="odd"><td> The Basic Tools plugin</td><td rowspan=1 colspan=2> <tt>plugins\pnp_basictools.dll</tt></td></tr><tr valign="top" class="even"><td> The ExtraFilters plugin</td><td rowspan=1 colspan=2> <tt>plugins\pnp_extrafilters.dll</tt></td></tr><tr valign="top" class="odd"><td> The Qt Core module</td><td rowspan=1 colspan=2> <tt>qtcore4.dll</tt></td></tr><tr valign="top" class="even"><td> The Qt GUI module</td><td rowspan=1 colspan=2> <tt>qtgui4.dll</tt></td></tr></table> In addition, the archive must contain the following compiler specific libraries depending on your version of Visual Studio: <table align="center" border="0" cellpadding="2" cellspacing="1" width="100%"><thead><tr class="qt-style" valign="top"><th><center></center></th><th><center> VC++ 6.0</center></th><th><center> VC++ 7.1 (2003)</center></th><th><center> VC++ 8.0 (2005)</center></th></tr></thead><tr valign="top" class="even"><td> The C run-time</td><td> <tt>msvcrt.dll</tt></td><td> <tt>msvcr71.dll</tt></td><td> <tt>msvcr80.dll</tt></td></tr><tr valign="top" class="odd"><td> The C++ run-time</td><td> <tt>msvcp60.dll</tt></td><td> <tt>msvcp71.dll</tt></td><td> <tt>msvcp80.dll</tt></td></tr></table> To verify that the application now can be successfully deployed, you can extract this archive on a machine without Qt and without any compiler installed, and try to run it. <p>An alternative to putting the plugins in the plugins subdirectory is to add a custom search path when you start your application using <a href="../../../com/trolltech/qt/core/QCoreApplication.html#addLibraryPath(java.lang.String)">QApplication::addLibraryPath()</a> or <a href="../../../com/trolltech/qt/core/QCoreApplication.html#setLibraryPaths(java.util.List<java.lang.String>)">QApplication::setLibraryPaths()</a>. <pre class="snippet">
qApp-&gt;addLibraryPath("C:\some\other\path");
</pre> One benefit of using plugins is that they can easily be made available to a whole family of applications. <p>It's often most convenient to add the path in the application's <tt>main()</tt> function, right after the <a href="../../../com/trolltech/qt/gui/QApplication.html">QApplication</a> object is created. Once the path is added, the application will search it for plugins, in addition to looking in the <tt>plugins</tt> subdirectory in the application's own directory. Any number of additional paths can be added.<a name="visual-studio-2005-onwards"><h3>Visual Studio 2005 Onwards</h3> When deploying an application compiled with Visual Studio 2005 onwards, there are some additional steps to be taken. <p>First, we need to copy the manifest file created when linking the application. This manifest file contains information about the application's dependencies on side-by-side assemblies, such as the runtime libraries. <p>The manifest file needs to be copied into the <b>same</b> folder as the application executable. You do not need to copy the manifest files for shared libraries (DLLs), since they are not used. <p>If the shared library has dependencies that are different from the application using it, the manifest file needs to be embedded into the DLL binary. Since Qt 4.1.3, the follwoing <tt>CONFIG</tt> options are available for embedding manifests: <pre class="snippet">
embed_manifest_dll
embed_manifest_exe
</pre> To use the options, add <pre class="snippet">
CONFIG += embed_manifest_exe
</pre> to your .pro file. The <tt>embed_manifest_dll</tt> option is enabled by default. <p>You can find more information about manifest files and side-by-side assemblies at the MSDN website. <p>There are two ways to include the run time libraries: by bundling them directly with your application or by installing them on the end-user's system. <p>To bundle the run time libraries with your application, copy the directory <pre class="snippet">
&lt;Visual Studio Install Path&gt;\VC\redist\&lt;Architecture&gt;\Microsoft.VC80.CRT
</pre> into the folder where your executable is, so that you are including a <tt>Microsoft.VC80.CRT</tt> directory alongside your application's executable. If you are bundling the runtimes and need to deploy plugins as well, you have to remove the manifest from the plugins (embedded as a resource) by adding the following line to the <tt>.pro</tt> file of the plugins you are compiling: <pre class="snippet">
CONFIG-=embed_manifest_dll
</pre> <b>Warning:</b> If you skip the step above, the plugins will not load on some systems. <p>To install the runtime libraries on the end-user's system, you need to include the appropriate Visual C++ Redistributable Package (VCRedist) executable with your application and ensure that it is executed when the user installs your application. <p>For example, on an 32-bit x86-based system, you would include the vcredist_x86.exe executable. The vcredist_IA64.exe and vcredist_x64.exe executables provide the appropriate libraries for the IA64 and 64-bit x86 architectures, respectively. <p><b>Note:</b> The application you ship must be compiled with exactly the same compiler version against the same C runtime version. This prevents deploying errors caused by different versions of the C runtime libraries.<a name="application-dependencies"><h2>Application Dependencies</h2><a name="additional-libraries"><h3>Additional Libraries</h3> Depending on configuration, compiler specific libraries must be redistributed along with your application. You can check which libraries your application is linking against by using the <a href="http://www.dependencywalker.com/">Dependency Walker</a> tool. All you need to do is to run it like this: <pre class="snippet">
depends &lt;application executable&gt;
</pre> This will provide a list of the libraries that your application depends on and other information. <br><center><img src="images/deployment-windows-depends.png"></center><br> When looking at the release build of the Plug & Paint executable (<tt>plugandpaint.exe</tt>) with the <tt>depends</tt> tool, the tool lists the following immediate dependencies to non-system libraries: <table align="center" border="0" cellpadding="2" cellspacing="1" width="100%"><thead><tr class="qt-style" valign="top"><th><center> Qt</center></th><th><center> VC++ 6.0</center></th><th><center> VC++ 7.1 (2003)</center></th><th><center> VC++ 8.0 (2005)</center></th><th><center> MinGW</center></th></tr></thead><tr valign="top" class="even"><td> <ul><li> QTCORE4.DLL - The <a href="qtcore.html">QtCore</a> runtime</li><li> QTGUI4.DLL - The <a href="qtgui.html">QtGui</a> runtime</li></ul></td><td> <ul><li> MSVCRT.DLL - The C runtime</li><li> MSVCP60.DLL - The C++ runtime (only when STL is installed)</li></ul></td><td> <ul><li> MSVCR71.DLL - The C runtime</li><li> MSVCP71.DLL - The C++ runtime (only when STL is installed)</li></ul></td><td> <ul><li> MSVCR80.DLL - The C runtime</li><li> MSVCP80.DLL - The C++ runtime (only when STL is installed)</li></ul></td><td> <ul><li> MINGWM10.DLL - The MinGW run-time</li></ul></td></tr></table> When looking at the plugin DLLs the exact same dependencies are listed.<a name="qt-plugins"><h3>Qt Plugins</h3> Your application may also depend on one or more Qt plugins, such as the JPEG image format plugin or a SQL driver plugin. Be sure to distribute any Qt plugins that you need with your application, and note that each type of plugin should be located within a specific subdirectory (such as <tt>imageformats</tt> or <tt>sqldrivers</tt>) within your distribution directory, as described below. <p>The search path for Qt plugins (as well as a few other paths) is hard-coded into the <a href="qtcore.html">QtCore</a> library. By default, the first plugin search path will be hard-coded to be a <tt>plugins</tt> subdirectory of the Qt installation: <pre class="snippet">
C:&lt;path to Qt&gt;\plugins
</pre> Pre-determined paths like this one have certain disadvantages. For example, they may not exist on the target machine. For that reason you need to examine various alternatives to make sure that the Qt plugins are found: <ul><li> <a href="qt-conf.html">Using qt.conf</a><tt>qt.conf</tt>. This is the recommended approach since it provides the most flexibility.</li><li> Using <a href="../../../com/trolltech/qt/core/QCoreApplication.html#addLibraryPath(java.lang.String)">QApplication::addLibraryPath()</a> or <a href="../../../com/trolltech/qt/core/QCoreApplication.html#setLibraryPaths(java.util.List<java.lang.String>)">QApplication::setLibraryPaths()</a>.</li><li> Using a third party installation utility to change the hard-coded paths in the <a href="qtcore.html">QtCore</a> library.</li></ul> The <a href="plugins-howto.html">How to Create Qt Plugins</a> document outlines the issues you need to pay attention to when building and deploying plugins for Qt applications.<p /><address><hr /><div align="center">
 <table width="100%" cellspacing="0" border="0"><tr class="address">
 <td width="30%">Copyright &copy; 2009 Nokia Corporation and/or its subsidiary(-ies)</td>
 <td width="40%" align="center"><a href="trademarks.html">Trademarks</a></td>
 <td width="30%" align="right"><div align="right">Qt Jambi 4.5.2_01</div></td>
 </tr></table></div></address></body></html>
