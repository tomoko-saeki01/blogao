<?xml version="1.0" encoding="iso-8859-1"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
<title>Creating Custom Widgets for Qt Designer</title><link href="classic.css" rel="stylesheet" type="text/css" />
</head><table border="0" cellpadding="0" cellspacing="0" width="100%">
 <tr>
 <td align="left" valign="top" width="32"> <img src="images/qt-logo.png" align="left" width="32" height="32" border="0" /> </td>
 <td width="1">&nbsp;&nbsp;</td> <td class="postheader" valign="center"> <a href="qtjambi-index.html"> <font color="#004faf">Home</font></a>&nbsp;&middot; <a href="qtjambi-examples.html"> <font color="#004faf">Examples</font></a>&nbsp; </td>
 </tr></table><body><p><hr><p><center><h1>Creating Custom Widgets for Qt Designer</h1></center><p>[<a href="designer-manual.html">Qt Designer Manual</a>][Next: <a href="designer-creating-custom-widgets-extensions.html">Creating Custom Widget Extensions</a>]<p> Qt Designer's plugin-based architecture allows user-defined and third party custom widgets to be edited just like you do with standard Qt widgets. All of the custom widget's features are made available to Qt Designer, including widget properties, signals, and slots. Since Qt Designer uses real widgets during the form design process, custom widgets will appear the same as they do when previewed. <br><center><img src="images/worldtimeclockplugin-example.png"></center><br> The <a href="qtdesigner.html">QtDesigner</a> module provides you with the ability to create cusom widgets in Qt Designer.<a name="getting-started"><h2>Getting Started</h2> To integrate a custom widget with Qt Designer, you require a suitable description for the widget and an appropriate <tt>.pro</tt> file.<a name="providing-an-interface-description"><h3>Providing an Interface Description</h3> To inform Qt Designer about the type of widget you want to provide, create a subclass of QDesignerCustomWidgetInterface that describes the various properties your widget exposes. Most of these are supplied by functions that are pure virtual in the base class, because only the author of the plugin can provide this information. <table align="center" border="0" cellpadding="2" cellspacing="1"><thead><tr class="qt-style" valign="top"><th><center> Function</center></th><th><center> Description of the return value</center></th></tr></thead><tr valign="top" class="even"><td> <tt>name()</tt></td><td> The name of the class that provides the widget.</td></tr><tr valign="top" class="odd"><td> <tt>group()</tt></td><td> The group in Qt Designer's widget box that the widget belongs to.</td></tr><tr valign="top" class="even"><td> <tt>toolTip()</tt></td><td> A short description to help users identify the widget in Qt Designer.</td></tr><tr valign="top" class="odd"><td> <tt>whatsThis()</tt></td><td> A longer description of the widget for users of Qt Designer.</td></tr><tr valign="top" class="even"><td> <tt>includeFile()</tt></td><td> The header file that must be included in applications that use this widget. This information is stored in .ui files and will be used by <tt>uic</tt> to create a suitable <tt>#includes</tt> statement in the code it generates for the form containing the custom widget.</td></tr><tr valign="top" class="odd"><td> <tt>icon()</tt></td><td> An icon that can be used to represent the widget in Qt Designer's widget box.</td></tr><tr valign="top" class="even"><td> <tt>isContainer()</tt></td><td> True if the widget will be used to hold child widgets; false otherwise.</td></tr><tr valign="top" class="odd"><td> <tt>createWidget()</tt></td><td> A <a href="../../../com/trolltech/qt/gui/QWidget.html">QWidget</a> pointer to an instance of the custom widget, constructed with the parent supplied. <b>Note:</b> createWidget() is a factory function responsible for creating the widget only. The custom widget's properties will not be available until load() returns.</td></tr><tr valign="top" class="even"><td> <tt>domXml()</tt></td><td> A description of the widget's properties, such as its object name, size hint, and other standard <a href="../../../com/trolltech/qt/gui/QWidget.html">QWidget</a> properties.</td></tr><tr valign="top" class="odd"><td> <tt>codeTemplate()</tt></td><td> This function is reserved for future use by Qt Designer.</td></tr></table> Two other virtual functions can also be reimplemented: <table align="center" border="0" cellpadding="2" cellspacing="1"><tr valign="top" class="even"><td> <tt>initialize()</tt></td><td> Sets up extensions and other features for custom widgets. Custom container extensions (see QDesignerContainerExtension) and task menu extensions (see QDesignerTaskMenuExtension) should be set up in this function.</td></tr><tr valign="top" class="odd"><td> <tt>isInitialized()</tt></td><td> Returns true if the widget has been initialized; returns false otherwise. Reimplementations usually check whether the <tt>initialize()</tt> function has been called and return the result of this test.</td></tr></table><a name="notes-on-the-function"><h3>Notes on the domXml() Function</h3><tt>domXml()</tt> The <tt>domXml()</tt> function returns a <tt>.ui</tt> file snippet that is used by Qt Designer's widget factory to create a custom widget and its applicable properties. <p>Since Qt 4.4, Qt Designer's widget box allows for a complete <tt>.ui</tt> file to describe <b>one</b> custom widget. The <tt>.ui</tt> file can be loaded using the <tt>&lt;ui&gt;</tt> tag. Specifying the &lt;ui&gt; tag allows for adding the &lt;customwidget&gt; element that contains additional information for custom widgets. The <tt>&lt;widget&gt;</tt> tag is sufficient if no additional information is required <p>If the custom widget does not provide a reasonable size hint, it is necessary to specify a default geometry in the string returned by the <tt>domXml()</tt> function in your subclass. For example, the <tt>AnalogClockPlugin</tt> provided by the <a href="designer-customwidgetplugin.html">Custom Widget Plugin</a> example, defines a default widgetgeometry in the following way:...<br><br>The following code example is written in c++.<br> <pre class="snippet">
           "  &lt;property name=\"geometry\"&gt;\n"
           "   &lt;rect&gt;\n"
           "    &lt;x&gt;0&lt;/x&gt;\n"
           "    &lt;y&gt;0&lt;/y&gt;\n"
           "    &lt;width&gt;100&lt;/width&gt;\n"
           "    &lt;height&gt;100&lt;/height&gt;\n"
           "   &lt;/rect&gt;\n"
           "  &lt;/property&gt;\n"
...</pre> An additional feature of the <tt>domXml()</tt> function is that, if it returns an empty string, the widget will not be installed in Qt Designer's widget box. However, it can still be used by other widgets in the form. This feature is used to hide widgets that should not be explicitly created by the user, but are required by other widgets. <p>If you would like to use a container widget that is not a subclass of the containers provided in Qt Designer, but the container is still based on the notion of Current Page, you need to provide a container extension and tell Qt Designer which method to use to add the pages. This can be done using the <tt>&lt;addpagemethod&gt;</tt> XML tag.<a name="plugin-requirements"><h2>Plugin Requirements</h2> In order for plugins to work correctly on all platforms, you need to ensure that they export the symbols needed by Qt Designer. <p>First of all, the plugin class must be exported in order for the plugin to be loaded by Qt Designer. Use the Q_EXPORT_PLUGIN2() macro to do this. Also, the QDESIGNER_WIDGET_EXPORT macro must be used to define each custom widget class within a plugin, that Qt Designer will instantiate.<a name="creating-well-behaved-widgets"><h2>Creating Well Behaved Widgets</h2> Some custom widgets have special user interface features that may make them behave differently to many of the standard widgets found in Qt Designer. Specifically, if a custom widget grabs the keyboard as a result of a call to <a href="../../../com/trolltech/qt/gui/QWidget.html#grabKeyboard()">QWidget::grabKeyboard()</a>, the operation of Qt Designer will be affected. <p>To give custom widgets special behavior in Qt Designer, provide an implementation of the initialize() function to configure the widget construction process for Qt Designer specific behavior. This function will be called for the first time before any calls to createWidget() and could perhaps set an internal flag that can be tested later when Qt Designer calls the plugin's createWidget() function.<a name="buildingandinstallingtheplugin"><a name="building-and-installing-the-plugin"><h2>Building and Installing the Plugin</h2> The <tt>.pro</tt> file for a plugin must specify the headers and sources for both the custom widget and the plugin interface. Typically, this file only has to specify that the plugin's project is to be built as a library, but with specific plugin support for Qt Designer. This is done with the following declarations:Error parsing snippet.</pre> If Qt is configured to build in both debug and release modes, Qt Designer will be built in release mode. When this occurs, it is necessary to ensure that plugins are also built in release mode. To do this, include the following declaration in the plugin's <tt>.pro</tt> file: <pre class="snippet">
CONFIG += release
</pre> If plugins are built in a mode that is incompatible with Qt Designer, they will not be loaded and installed. For more information about plugins, see the <a href="plugins-howto.html">Plugins HOWTO</a> document. <p>It is also necessary to ensure that the plugin is installed together with other Qt Designer widget plugins: <pre class="snippet">
target.path = $$[QT_INSTALL_PLUGINS]/designer
INSTALLS += target
</pre> The <tt>$[QT_INSTALL_PLUGINS]</tt> variable is a placeholder to the location of the installed Qt plugins. You can configure Qt Designer to look for plugins in other locations by setting the <tt>QT_PLUGIN_PATH</tt> environment variable before running the application. <p><b>Note:</b>Qt Designer will look for a <tt>designer</tt> subdirectory in each path supplied. <p>See <a href="../../../com/trolltech/qt/core/QCoreApplication.html#libraryPaths()">QCoreApplication::libraryPaths()</a> for more information about customizing paths for libraries and plugins with Qt applications.<a name="related-examples"><h2>Related Examples</h2> For more information on using custom widgets in Qt Designer, refer to the <a href="designer-customwidgetplugin.html">Custom Widget Plugin</a> and <a href="designer-worldtimeclockplugin.html">World Time Clock Plugin</a> examples for more information about using custom widgets in Qt Designer. Also, you can use the QDesignerCustomWidgetCollectionInterface class to combine several custom widgets into a single library.<p /><address><hr /><div align="center">
 <table width="100%" cellspacing="0" border="0"><tr class="address">
 <td width="30%">Copyright &copy; 2009 Nokia Corporation and/or its subsidiary(-ies)</td>
 <td width="40%" align="center"><a href="trademarks.html">Trademarks</a></td>
 <td width="30%" align="right"><div align="right">Qt Jambi 4.5.2_01</div></td>
 </tr></table></div></address></body></html>
