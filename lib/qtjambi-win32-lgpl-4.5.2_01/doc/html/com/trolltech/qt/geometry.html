<?xml version="1.0" encoding="iso-8859-1"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
<title>Window Geometry</title><link href="classic.css" rel="stylesheet" type="text/css" />
</head><table border="0" cellpadding="0" cellspacing="0" width="100%">
 <tr>
 <td align="left" valign="top" width="32"> <img src="images/qt-logo.png" align="left" width="32" height="32" border="0" /> </td>
 <td width="1">&nbsp;&nbsp;</td> <td class="postheader" valign="center"> <a href="qtjambi-index.html"> <font color="#004faf">Home</font></a>&nbsp;&middot; <a href="qtjambi-examples.html"> <font color="#004faf">Examples</font></a>&nbsp; </td>
 </tr></table><body><p><hr><p><center><h1>Window Geometry</h1></center><p>An overview of window geometry handling and management. <a href="../../../com/trolltech/qt/gui/QWidget.html">QWidget</a> provides several functions that deal with a widget's geometry. Some of these functions operate on the pure client area (i.e. the window excluding the window frame), others include the window frame. The differentiation is done in a way that covers the most common usage transparently. <ul><li> <b>Including the window frame:</b><a href="../../../com/trolltech/qt/gui/QWidget.html#x()">x()</a>, <a href="../../../com/trolltech/qt/gui/QWidget.html#y()">y()</a>, <a href="../../../com/trolltech/qt/gui/QWidget.html#frameGeometry()">frameGeometry()</a>, <a href="../../../com/trolltech/qt/gui/QWidget.html#pos()">pos()</a>, and <a href="../../../com/trolltech/qt/gui/QWidget.html#move(com.trolltech.qt.core.QPoint)">move()</a>.</li><li> <b>Excluding the window frame:</b><a href="../../../com/trolltech/qt/gui/QWidget.html#geometry()">geometry()</a>, <a href="../../../com/trolltech/qt/gui/QWidget.html#width()">width()</a>, <a href="../../../com/trolltech/qt/gui/QWidget.html#height()">height()</a>, <a href="../../../com/trolltech/qt/gui/QWidget.html#rect()">rect()</a>, and <a href="../../../com/trolltech/qt/gui/QWidget.html#size()">size()</a>.</li></ul> Note that the distinction only matters for decorated top-level widgets. For all child widgets, the frame geometry is equal to the widget's client geometry. <p>This diagram shows most of the functions in use: <br><center><img src="images/geometry.png"></center><br> Topics: <ul><li> <a href="#x11-peculiarities">X11 Peculiarities</a></li><li> <a href="#restoring-a-window-s-geometry">Restoring a Window's Geometry</a></li></ul><a name="x11-peculiarities"><h2>X11 Peculiarities</h2> On X11, a window does not have a frame until the window manager decorates it. This happens asynchronously at some point in time after calling <a href="../../../com/trolltech/qt/gui/QWidget.html#show()">QWidget::show()</a> and the first paint event the window receives, or it does not happen at all. Bear in mind that X11 is policy-free (others call it flexible). Thus you cannot make any safe assumption about the decoration frame your window will get. Basic rule: There's always one user who uses a window manager that breaks your assumption, and who will complain to you. <p>Furthermore, a toolkit cannot simply place windows on the screen. All Qt can do is to send certain hints to the window manager. The window manager, a separate process, may either obey, ignore or misunderstand them. Due to the partially unclear Inter-Client Communication Conventions Manual (ICCCM), window placement is handled quite differently in existing window managers. <p>X11 provides no standard or easy way to get the frame geometry once the window is decorated. Qt solves this problem with nifty heuristics and clever code that works on a wide range of window managers that exist today. Don't be surprised if you find one where <a href="../../../com/trolltech/qt/gui/QWidget.html#frameGeometry()">QWidget::frameGeometry()</a> returns wrong results though. <p>Nor does X11 provide a way to maximize a window. <a href="../../../com/trolltech/qt/gui/QWidget.html#showMaximized()">QWidget::showMaximized()</a> has to emulate the feature. Its result depends on the result of <a href="../../../com/trolltech/qt/gui/QWidget.html#frameGeometry()">QWidget::frameGeometry()</a> and the capability of the window manager to do proper window placement, neither of which can be guaranteed.<a name="restoring-a-window-s-geometry"><h2>Restoring a Window's Geometry</h2> Since version 4.2, Qt provides functions that saves and restores a window's geometry and state for you. <a href="../../../com/trolltech/qt/gui/QWidget.html#saveGeometry()">QWidget::saveGeometry()</a> saves the window geometry and maximized/fullscreen state, while <a href="../../../com/trolltech/qt/gui/QWidget.html#restoreGeometry(com.trolltech.qt.core.QByteArray)">QWidget::restoreGeometry()</a> restores it. The restore function also checks if the restored geometry is outside the available screen geometry, and modifies it as appropriate if it is. <p>The rest of this document describes how to save and restore the geometry using the geometry properties. On Windows, this is basically storing the result of <a href="../../../com/trolltech/qt/gui/QWidget.html#geometry()">QWidget::geometry()</a> and calling <a href="../../../com/trolltech/qt/gui/QWidget.html#setGeometry(com.trolltech.qt.core.QRect)">QWidget::setGeometry()</a> in the next session before calling <a href="../../../com/trolltech/qt/gui/QWidget.html#show()">show()</a>. On X11, this won't work because an invisible window doesn't have a frame yet. The window manager will decorate the window later. When this happens, the window shifts towards the bottom/right corner of the screen depending on the size of the decoration frame. Although X provides a way to avoid this shift, most window managers fail to implement this feature. <p>A workaround is to call <a href="../../../com/trolltech/qt/gui/QWidget.html#setGeometry(com.trolltech.qt.core.QRect)">setGeometry()</a> after <a href="../../../com/trolltech/qt/gui/QWidget.html#show()">show()</a>. This has the two disadvantages that the widget appears at a wrong place for a millisecond (results in flashing) and that currently only every second window manager gets it right. A safer solution is to store both <a href="../../../com/trolltech/qt/gui/QWidget.html#pos()">pos()</a> and <a href="../../../com/trolltech/qt/gui/QWidget.html#size()">size()</a> and to restore the geometry using <a href="../../../com/trolltech/qt/gui/QWidget.html#resize(com.trolltech.qt.core.QSize)">QWidget::resize()</a> and <a href="../../../com/trolltech/qt/gui/QWidget.html#move(com.trolltech.qt.core.QPoint)">move()</a> before calling <a href="../../../com/trolltech/qt/gui/QWidget.html#show()">show()</a>, as demonstrated in the following code snippets (from the <a href="qtjambi-application.html">Application</a> example):<br><br>The following code example is written in c++.<br> <pre class="snippet">
void MainWindow::readSettings()
 
{
    QSettings settings("Trolltech", "Application Example");
    QPoint pos = settings.value("pos", QPoint(200, 200)).toPoint();
    QSize size = settings.value("size", QSize(400, 400)).toSize();
    resize(size);
    move(pos);
}
<br>
void MainWindow::writeSettings()
 
{
    QSettings settings("Trolltech", "Application Example");
    settings.setValue("pos", pos());
    settings.setValue("size", size());
}
</pre> This method works on Windows, Mac OS X, and most X11 window managers.<p /><address><hr /><div align="center">
 <table width="100%" cellspacing="0" border="0"><tr class="address">
 <td width="30%">Copyright &copy; 2009 Nokia Corporation and/or its subsidiary(-ies)</td>
 <td width="40%" align="center"><a href="trademarks.html">Trademarks</a></td>
 <td width="30%" align="right"><div align="right">Qt Jambi 4.5.2_01</div></td>
 </tr></table></div></address></body></html>
