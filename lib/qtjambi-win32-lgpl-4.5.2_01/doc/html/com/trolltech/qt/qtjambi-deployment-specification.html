<?xml version="1.0" encoding="iso-8859-1"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
<title></title><link href="classic.css" rel="stylesheet" type="text/css" />
</head><table border="0" cellpadding="0" cellspacing="0" width="100%">
 <tr>
 <td align="left" valign="top" width="32"> <img src="images/qt-logo.png" align="left" width="32" height="32" border="0" /> </td>
 <td width="1">&nbsp;&nbsp;</td> <td class="postheader" valign="center"> <a href="qtjambi-index.html"> <font color="#004faf">Home</font></a>&nbsp;&middot; <a href="qtjambi-examples.html"> <font color="#004faf">Examples</font></a>&nbsp; </td>
 </tr></table><body><p><hr><p><center><h1></h1></center><p><a name="the-qt-jambi-deployment-specification"><h2>The Qt Jambi Deployment Specification</h2> The Qt Jambi deployment specification is a simple XML file, named <tt>qtjambi-deployment.xml</tt>, which is located in the root of a platform archive. It contains a list of all libraries that the platform archive contains and which of them should be loaded automatically and which should only be unpacked. The details of the deployment specification is provided here primarly as background information for the curious reader. For normal deployment scenarios, its contents is automatically generated by the ant build tasks described further down in this document.<a name="the-element"><h3>The qtjambi-deploy Element</h3><tt>qtjambi-deploy</tt> This is the root element of the XML file. It is used to identify the validity of the XML file and to describe which target system this file is meant for. It can have the following attributes: <ul><li> <tt>system</tt>; The system, either "win32", "win64", "linux32", "linux64" or "macosx".</li></ul> If the system attribute does not match the current running system, the entire platform archive is igonred, and none of its contents is loaded.<a name="the-element"><h3>The cache Element</h3><tt>cache</tt> The platform archive will be unpacked into a temporary directory so that the process can load the native libraries. To avoid that libraries conflicts between libraries compiled with different compilers or for different target systems, such as windows 32-bit and windows 64-bit, we recommend specifying a unique cache key for your own deployment specifications when building your own platform archives. The cache is specified like this:<pre>&lt;qtjambi-deploy ...&gt;
  &lt;cache key="my.unique.key" /&gt;</pre><a name="the-element"><h3>The library Element</h3><tt>library</tt> The library element is used to describe a library in the platform arhive. A library is listed with its full name and path inside the platform archive and will be unpacked to the temporary directory with its directory structure intact. <p>The <tt>library</tt> element can have the following attributes: <ul><li> <tt>name</tt>; This attribute is the full path and filename of the library inside the platform archive.</li><li> <tt>load</tt>; This attribute describes how the library should be loaded. <ul><li> <tt>never</tt>; The library is only unpacked, and any attempt to explicitly load it will yield a runtime exception. Typically used for plugins.</li><li> <tt>yes</tt>; The library is loaded when it is unpacked. This is typically used for runtime libraries, except the Visual Studio 2005 and 2008 runtimes which \b must only ever be unpacked, never loaded.</li><li> <tt>default</tt>; The library is unpacked, and lazily loaded based on calls to {Utilities.loadJambiLibrary()} and <tt>Utilities.loadLibrary()</tt>.</li></ul></li></ul> Elements are added to the deployment spec in the following manner:<pre>&lt;qtjambi-deploy ...&gt;
  &lt;library name="bin/mylib.dll" /&gt;
  ...</pre><a name="the-element"><h3>The plugin Element</h3><tt>plugin</tt> The plugin element describes which directories in the unpacked platform archive should be treated as a root for Qt C++ plugins. Each entry correponds to a call to <tt>QApplication.addLibraryPath()</tt>. Elements are added to the deployment specification in the following manner:<pre>&lt;qtjambi-deploy ..&gt;
  &lt;plugin path="thePluginDirectory" /&gt;
  ...</pre><a name="creating-platform-archives-using-ant"><h2>Creating Platform Archives using ANT</h2> This document describes how to make use of Qt Jambi's ant specific classes to help build a platform specific JAR file for your project. <p>The tasks are available in the <tt>ant-qtjambi.jar</tt> file in the classes <tt>com.trolltech.tools.ant.InitializeTask</tt> and <tt>com.trolltech.tools.ant.PlatformJarTask</tt>. To make use of the task in an <tt>ant</tt> build script you need the following commands:<pre>    &lt;taskdef name="qtjambi-initialize"
             classpath="ant-qtjambi.jar"
             classname="com.trolltech.tools.ant.InitializeTask"/&gt;
    &lt;taskdef name="qtjambi-platform-jar"
             classpath="ant-qtjambi.jar"
             classname="com.trolltech.tools.ant.PlatformJarTask"/&gt;</pre><a name="initialization-task"><h3>Initialization Task</h3> The <tt>InitializeTask</tt>'s primary purpose is to define a set of variables to aid the <tt>PlatformJarTask</tt>. It should be run as early as possible, in the following manner:<pre>&lt;qtjambi-initialize verbose="true" /&gt;</pre><a name="input-parameters"><h4>Input Parameters</h4> <ul><li> <tt>verbose</tt>; Can be <tt>true</tt> or <tt>false</tt>. When set to true, the task will print out the specific variables it detects.</li></ul><a name="variables"><h4>Variables</h4> Below is a list of the various variables defined by the task. They are accessible throughout the <tt>ant</tt> build script, after the task has been completed. To access the properties use the default <tt>ant</tt> syntax, for instance:<pre>  &lt;jar destfile="qtjambi-${qtjambi.version}.jar"&gt;</pre> to access the property <tt>qtjambi.version</tt>. <ul><li> <tt>qtjambi.osname</tt>; This variable contains the operating system name, such as win32 or linux64</li><li> <tt>qtjambi.libsubdir</tt>; This variable contains the default subdirectory used for libraries for the current operating system, typically <tt>bin for windows and \c lib for other platforms. \o \c qtjambi.qtdir</tt>; The location of Qt, picked up from the environment variable QTDIR. If QTDIR is not available when the task is running an error will be thrown.</li><li> <tt>qtjambi.qmakespec</tt>; A variable used for Qt and qmake to decide buildsystem, picked up from the environment variable QMAKESPEC or from the compiler currently available in PATH.</li><li> <tt>qtjambi.version</tt>; The version of Qt Jambi, on the form "Major.Minor.Patch_buildnumber", for instance 4.4.0_01.</li><li> <tt>qtjambi.compiler</tt>; The compiler used to compile the C++ parts of Qt Jambi.</li><li> <tt>qtjambi.vsinstalldir</tt>; With MSVC 2005 and 2008 only. The location where Visual Studio is installed. This is picked up from the environment variable VSINSTALLDIR and is required if the MSVC 2005 or 2008 compilers are in use. For internal use only.</li><li> <tt>qtjambi.vsredistdir</tt>; With MSVC 2005 and 2008 only. The location describing where the Visual Studio runtimes are available. For internal use only.</li></ul><a name="platform-archive-task"><h3>Platform Archive Task</h3> The purpose of the platform archive task is to register input libraries and copy them to an output folder, along with any dependent system runtime libraries. It also generates a deployment specification for the libraries so the content of the output folder simply can be packed into a qtjambi platform archive used for loading. <p>The benefit of using this task to generate the deployement spec and the directory structure is that this task will handle the problematic aspects of Microsoft Visual Studio 2005 and 2008, manifest based, deployment for instance.<a name="attributes"><h4>Attributes</h4> <ul><li> <tt>cacheKey</tt>; This parameter specifies the cache key to be used in the deployment specification.</li><li> <tt>outdir</tt>; This parameter specifies the base directory used for the qtjambi-deployment.xml and the libraries that are to be included in the platform jar.</li><li> <tt>syslibs</tt>; This parameter specifies if the task should handle system libs or not. The value can be either "auto" or "none", where "auto" is the default.</li></ul><a name="library-entries"><h4>Library Entries</h4> The platform specification is built up from multiple library entries. Library entries are specified in the followin manner:<pre>&lt;qtjambi-platform-jar&gt;
  &lt;library name="..." ...&gt;</pre> The library entry can have the following attributes: <ul><li> <tt>name</tt>; This attribute describes the name of the library, without the platform specific suffix and extension.</li><li> <tt>type</tt>; This attribute describes the type of library and can be: <ul><li> <tt>qt</tt>; A Qt C++ library.</li><li> <tt>qtjambi</tt>; A Qt Jambi or normal JNI native library.</li><li> <tt>plugin</tt>; A Qt C++ plugin library.</li></ul></li><li> <tt>rootDir</tt>; This attribute describes the root directory for where to search for the directory.</li><li> <tt>subdir</tt>; This attribute contains the subdirectory relative from <tt>rootDir</tt> to where the library is located. By default this value is set to the typical platform specific library directory which is <tt>bin</tt> on Windows and <tt>lib</tt> for other platforms. The library will maintain this directory structure in the final platform archive.</li><li> <tt>load</tt>; This attribute describes when and how the library should be loaded if at all. The possible values are: <ul><li> <tt>never</tt>; The library cannot be loaded using <tt>Utilities.loadJambiLibrary()</tt> or <tt>Utilities.loadLibrary()</tt>. This value is normally used for plugins.</li><li> <tt>yes</tt>; The library is automatically loaded when the platform archive is first unpacked by Qt Jambi. This is normally used for system libraries, so the user rarely has to use it.</li><li> <tt>default</tt>; The library can and will be loaded using calls to {Utilities.loadJambiLibrary()} or <tt>Utilities.loadLibrary()</tt>. This is the default value.</li></ul></li></ul><a name="plugin-entries"><h4>Plugin Entries</h4> In addition to containing library entries, a platform archive can contain a list a plugin paths that are automatically added, so Qt knows where to search for Qt C++ plugins. Each plugin entry will end up result in a call to <tt>QApplicaiton.addLibraryPath()</tt> when the platform archive is loaded. For instance:<pre>   &lt;qtjambi-platform-jar ...&gt;
     &lt;library name="qjpeg"
              type="plugin"
              subdir="plugins/imageformats"
              rootDir="${qtjambi.qtdir}"
              load="never"/&gt;
     &lt;plugin path="plugins" /&gt;</pre><p /><address><hr /><div align="center">
 <table width="100%" cellspacing="0" border="0"><tr class="address">
 <td width="30%">Copyright &copy; 2009 Nokia Corporation and/or its subsidiary(-ies)</td>
 <td width="40%" align="center"><a href="trademarks.html">Trademarks</a></td>
 <td width="30%" align="right"><div align="right">Qt Jambi 4.5.2_01</div></td>
 </tr></table></div></address></body></html>
