<?xml version="1.0" encoding="iso-8859-1"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
<title>Object and Value Types</title><link href="classic.css" rel="stylesheet" type="text/css" />
</head><table border="0" cellpadding="0" cellspacing="0" width="100%">
 <tr>
 <td align="left" valign="top" width="32"> <img src="images/qt-logo.png" align="left" width="32" height="32" border="0" /> </td>
 <td width="1">&nbsp;&nbsp;</td> <td class="postheader" valign="center"> <a href="qtjambi-index.html"> <font color="#004faf">Home</font></a>&nbsp;&middot; <a href="qtjambi-examples.html"> <font color="#004faf">Examples</font></a>&nbsp; </td>
 </tr></table><body><p><hr><p><center><h1>Object and Value Types</h1></center><p> In C++, we have a distinction between object and value types. A value type is typically added to the stack and sent by const reference in C++. An object type is typically allocated on the heap, and passed between functions using pointers. <p>In java, all objects behave like C++ object types. The Java primitives (e.g., int, char, and long) behave like C++ value types. All objects are passed using Java references (which are similar to pointers in C++) and primitives are passed by value. <p>When a class is mapped in the type system, the generator needs to know if it should be treated as an object or a value type. Object types will be sent by Java reference to methods and value types will be copied, and the copy will then be sent (also by Java reference) to methods. <p>Note that when a class has been declared as an object type, the generator will not accept functions in which it is passed by const reference in C++. <p>In this example, we look at a type system containing both object and value types. We also show how to deal with inheritance and polymorphic datatypes.<a name="disk-collection-example"><h2>Disk Collection Example</h2> We have a small library that can keep track of a disk collection, containing CD, DVD, and BlueRay disks. We have the <tt>DiskCollection</tt> class, which knows how to store and retrieve disks from a disk storage. Data about a single disk is stored in the <tt>EntryData</tt> class. We have a hierarchy of polymorphic disk classes with <tt>Disk</tt> as the base class. <tt>Disk</tt> has three subclasses representing CDs, DVDs, and BlueRays. <p>The important thing to remember when creating class hierarchies is that Java supports runtime type inference, which, for instance, gives life to the <tt>instanceof</tt> operator. For this to work, we need to equip Qt Jambi with a way to identify the type of objects at runtime. <p>This is how the type system looks for the disk classes:<pre>&lt;object-type name="Disk" polymorphic-base="yes" /&gt;
&lt;object-type name="CD" polymorphic-id-expression="%1-&gt;type() == Disk::CDType" /&gt;
&lt;object-type name="DVD"  polymorphic-id-expression="%1-&gt;type() == Disk::DVDType" /&gt;
&lt;object-type name="BlueRay" polymorphic-id-expression="%1-&gt;type() == Disk::BlueRayType" /&gt;</pre> The <tt>polymorphic-id-expression</tt> is a C++ expression evaluating to a <tt>bool</tt> value, which is true if the object of wich type is determined is an instance of the given <a href="qtjambi-typesystem.html">object-type</a>; the generator simply inserts this into the generated C++ code when it needs to do runtime type inference. Note that <tt>%1</tt> is the object of which type is to be determined. <p>The typesystem will now issue a warning because it assumes that <tt>Disk</tt> needs it's own polymorphic-id-expression. However, since <tt>Disk</tt> is the base class, this check is not necessary. We can silence the generator by giving it a <tt>suppress-warning</tt>.<pre>&lt;suppress-warning text="*class 'Disk' inherits from polymorphic class 'Disk'*" /&gt;</pre> We also want to stop the generator complaints about the unmapped <tt>Disk::Type</tt> enum, which we only use for the type inference.<pre>&lt;suppress-warning text="*enum 'Disk::Type' does not have a type entry or is not an enum*" /&gt;</pre> Note that for all <a href="../../../com/trolltech/qt/core/QObject.html">QObject</a> subclasses, type inference is handeled automatically. <p>We also have one <tt>value-type</tt> in our type system, the <tt>EntryData</tt> class. For a value type, you must implement a default constructor, and it can not have virtual functions or be the base of other classes.<p /><address><hr /><div align="center">
 <table width="100%" cellspacing="0" border="0"><tr class="address">
 <td width="30%">Copyright &copy; 2009 Nokia Corporation and/or its subsidiary(-ies)</td>
 <td width="40%" align="center"><a href="trademarks.html">Trademarks</a></td>
 <td width="30%" align="right"><div align="right">Qt Jambi 4.5.2_01</div></td>
 </tr></table></div></address></body></html>
