<?xml version="1.0" encoding="iso-8859-1"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
<title>Code for SVG Cards Example</title><link href="classic.css" rel="stylesheet" type="text/css" />
</head><table border="0" cellpadding="0" cellspacing="0" width="100%">
 <tr>
 <td align="left" valign="top" width="32"> <img src="images/qt-logo.png" align="left" width="32" height="32" border="0" /> </td>
 <td width="1">&nbsp;&nbsp;</td> <td class="postheader" valign="center"> <a href="qtjambi-index.html"> <font color="#004faf">Home</font></a>&nbsp;&middot; <a href="qtjambi-examples.html"> <font color="#004faf">Examples</font></a>&nbsp; </td>
 </tr></table><body><p><hr><p><center><h1>Code for SVG Cards Example</h1></center><p><pre class="snippet"><html style="white-space:pre-wrap;font-family:courier new"><font color=darkgreen><i>/****************************************************************************
 **
 ** Copyright (C) 1992-2009 Nokia Corporation and/or its subsidiary(-ies).
** All rights reserved.
 **
 ** This file is part of Qt Jambi.
 **
 ** 
** Commercial Usage
** Licensees holding valid Qt Commercial licenses may use this file in
** accordance with the Qt Commercial License Agreement provided with the
** Software or, alternatively, in accordance with the terms contained in
** a written agreement between you and Nokia.
** 
** GNU Lesser General Public License Usage
** Alternatively, this file may be used under the terms of the GNU Lesser
** General Public License version 2.1 as published by the Free Software
** Foundation and appearing in the file LICENSE.LGPL included in the
** packaging of this file.  Please review the following information to
** ensure the GNU Lesser General Public License version 2.1 requirements
** will be met: http:<font color=darkgreen><i>//www.gnu.org/licenses/old-licenses/lgpl-2.1.html.
</i></font>** 
** In addition, as a special exception, Nokia gives you certain
** additional rights. These rights are described in the Nokia Qt LGPL
** Exception version 1.0, included in the file LGPL_EXCEPTION.txt in this
** package.
** 
** GNU General Public License Usage
** Alternatively, this file may be used under the terms of the GNU
** General Public License version 3.0 as published by the Free Software
** Foundation and appearing in the file LICENSE.GPL included in the
** packaging of this file.  Please review the following information to
** ensure the GNU General Public License version 3.0 requirements will be
** met: http:<font color=darkgreen><i>//www.gnu.org/copyleft/gpl.html.
</i></font>** 
** If you are unsure which license is appropriate for your use, please
** contact the sales department at qt-sales@nokia.com.
 **
 ** This file is provided AS IS with NO WARRANTY OF ANY KIND, INCLUDING THE
 ** WARRANTY OF DESIGN, MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE.
 **
 ****************************************************************************/</i></font>
<font color=blue>package</font> com.trolltech.examples;

<font color=blue>import</font> com.trolltech.qt.core.*;
<font color=blue>import</font> com.trolltech.qt.gui.*;
<font color=blue>import</font> com.trolltech.qt.svg.*;
<font color=blue>import</font> java.util.*;

@<font color=darkmagenta><i>QtJambiExample</i></font>(name = <font color=darkgreen><i>"SVG Card Deck"</i></font>,
                canInstantiate = <font color=darkgreen><i>"call-static-method:notWebstart"</i></font>)
<font color=blue>public</font> <font color=blue>class</font> SvgCards <font color=blue>extends</font> <font color=darkmagenta><i>QGraphicsView</i></font> {
    <font color=blue>private</font> <font color=blue>boolean</font> closing = false;

    <font color=blue>private</font> <font color=blue>static</font> String[] CARDS = {
        <font color=darkgreen><i>"black_joker"</i></font>,
        <font color=darkgreen><i>"red_joker"</i></font>,
        <font color=darkgreen><i>"back"</i></font>,
        <font color=darkgreen><i>"king_club"</i></font>,
        <font color=darkgreen><i>"king_diamond"</i></font>,
        <font color=darkgreen><i>"king_heart"</i></font>,
        <font color=darkgreen><i>"king_spade"</i></font>,
        <font color=darkgreen><i>"queen_club"</i></font>,
        <font color=darkgreen><i>"queen_diamond"</i></font>,
        <font color=darkgreen><i>"queen_heart"</i></font>,
        <font color=darkgreen><i>"queen_spade"</i></font>,
        <font color=darkgreen><i>"jack_club"</i></font>,
        <font color=darkgreen><i>"jack_diamond"</i></font>,
        <font color=darkgreen><i>"jack_heart"</i></font>,
        <font color=darkgreen><i>"jack_spade"</i></font>,
        <font color=darkgreen><i>"1_club"</i></font>,
        <font color=darkgreen><i>"1_diamond"</i></font>,
        <font color=darkgreen><i>"1_heart"</i></font>,
        <font color=darkgreen><i>"1_spade"</i></font>,
        <font color=darkgreen><i>"2_club"</i></font>,
        <font color=darkgreen><i>"2_diamond"</i></font>,
        <font color=darkgreen><i>"2_heart"</i></font>,
        <font color=darkgreen><i>"2_spade"</i></font>,
        <font color=darkgreen><i>"3_club"</i></font>,
        <font color=darkgreen><i>"3_diamond"</i></font>,
        <font color=darkgreen><i>"3_heart"</i></font>,
        <font color=darkgreen><i>"3_spade"</i></font>,
        <font color=darkgreen><i>"4_club"</i></font>,
        <font color=darkgreen><i>"4_diamond"</i></font>,
        <font color=darkgreen><i>"4_heart"</i></font>,
        <font color=darkgreen><i>"4_spade"</i></font>,
        <font color=darkgreen><i>"5_club"</i></font>,
        <font color=darkgreen><i>"5_diamond"</i></font>,
        <font color=darkgreen><i>"5_heart"</i></font>,
        <font color=darkgreen><i>"5_spade"</i></font>,
        <font color=darkgreen><i>"6_club"</i></font>,
        <font color=darkgreen><i>"6_diamond"</i></font>,
        <font color=darkgreen><i>"6_heart"</i></font>,
        <font color=darkgreen><i>"6_spade"</i></font>,
        <font color=darkgreen><i>"7_club"</i></font>,
        <font color=darkgreen><i>"7_diamond"</i></font>,
        <font color=darkgreen><i>"7_heart"</i></font>,
        <font color=darkgreen><i>"7_spade"</i></font>,
        <font color=darkgreen><i>"8_club"</i></font>,
        <font color=darkgreen><i>"8_diamond"</i></font>,
        <font color=darkgreen><i>"8_heart"</i></font>,
        <font color=darkgreen><i>"8_spade"</i></font>,
        <font color=darkgreen><i>"9_club"</i></font>,
        <font color=darkgreen><i>"9_diamond"</i></font>,
        <font color=darkgreen><i>"9_heart"</i></font>,
        <font color=darkgreen><i>"9_spade"</i></font>,
        <font color=darkgreen><i>"10_club"</i></font>,
        <font color=darkgreen><i>"10_diamond"</i></font>,
        <font color=darkgreen><i>"10_heart"</i></font>,
        <font color=darkgreen><i>"10_spade"</i></font>
    };

    @Override
    <font color=blue>protected</font> <font color=blue>void</font> closeEvent(<font color=darkmagenta><i>QCloseEvent</i></font> e) {
        closing = true;
    }

    <font color=blue>private</font> <font color=blue>static</font> <font color=blue>class</font> Card <font color=blue>extends</font> <font color=darkmagenta><i>QGraphicsSvgItem</i></font> {
        <font color=blue>private</font> <font color=blue>double</font> opacity = 1.0;
        <font color=blue>private</font> CardManager manager;

        <font color=blue>public</font> Card(String card, <font color=darkmagenta><i>QSvgRenderer</i></font> renderer) {
            <font color=blue>super</font>();
            setElementId(card);
            setSharedRenderer(renderer);
            setParent(renderer);
        }

        <font color=blue>public</font> <font color=blue>void</font> setManager(CardManager newManager) {
            manager = newManager;
        }

        <font color=blue>public</font> String cardName() {
            <font color=blue>return</font> elementId();
        }

        @Override
        <font color=blue>public</font> <font color=blue>void</font> mousePressEvent(<font color=darkmagenta><i>QGraphicsSceneMouseEvent</i></font> event) {
            setZValue(10);
            opacity = 0.7;
            manager.startedMove(<font color=blue>this</font>);
            <font color=blue>super</font>.mousePressEvent(event);
        }

        @Override
        <font color=blue>public</font> <font color=blue>void</font> mouseReleaseEvent(<font color=darkmagenta><i>QGraphicsSceneMouseEvent</i></font> event) {
            opacity = 1.0;
            setZValue(5);
            manager.stoppedMove(<font color=blue>this</font>);
            <font color=blue>super</font>.mouseReleaseEvent(event);
        }

        @Override
        <font color=blue>public</font> <font color=blue>void</font> paint(<font color=darkmagenta><i>QPainter</i></font> painter, <font color=darkmagenta><i>QStyleOptionGraphicsItem</i></font> option,
                          <font color=darkmagenta><i>QWidget</i></font> widget) {
            painter.setOpacity(opacity);
            <font color=blue>super</font>.paint(painter, option, widget);
        }
    }

    <font color=blue>private</font> <font color=blue>static</font> <font color=blue>class</font> CardBox <font color=blue>extends</font> <font color=darkmagenta><i>QGraphicsItem</i></font> {
        <font color=blue>private</font> <font color=darkmagenta><i>QRectF</i></font> rectangle;
        <font color=blue>private</font> String status = <font color=darkgreen><i>"Loading Cards..."</i></font>;

        <font color=blue>public</font> CardBox() {
            <font color=blue>super</font>();
            rectangle = <font color=blue>new</font> <font color=darkmagenta><i>QRectF</i></font>(0, 0, 200, 50);
        }

        @Override
        <font color=blue>public</font> <font color=darkmagenta><i>QRectF</i></font> boundingRect() {
            <font color=blue>return</font> rectangle;
        }

        @Override
        <font color=blue>public</font> <font color=blue>void</font> paint(<font color=darkmagenta><i>QPainter</i></font> painter, <font color=darkmagenta><i>QStyleOptionGraphicsItem</i></font> option,
                          <font color=darkmagenta><i>QWidget</i></font> widget) {

            painter.setRenderHint(<font color=darkmagenta><i>QPainter</i></font>.RenderHint.Antialiasing);
            painter.setPen(<font color=blue>new</font> <font color=darkmagenta><i>QPen</i></font>(<font color=darkmagenta><i>QColor</i></font>.black));
            <font color=darkmagenta><i>QLinearGradient</i></font> gradient = <font color=blue>new</font> <font color=darkmagenta><i>QLinearGradient</i></font>(rectangle.topLeft(),
                                                           rectangle.bottomLeft());
            gradient.setColorAt(0, <font color=blue>new</font> <font color=darkmagenta><i>QColor</i></font>(0, 0, 0, 127));
            gradient.setColorAt(1, <font color=blue>new</font> <font color=darkmagenta><i>QColor</i></font>(255, 255, 255, 127));
            painter.setBrush(<font color=blue>new</font> <font color=darkmagenta><i>QBrush</i></font>(gradient));
            painter.drawRoundRect(rectangle, (<font color=blue>int</font>) (25 * rectangle.height()
                                                    / rectangle.width()), 25);
            painter.save();

            <font color=darkmagenta><i>QFont</i></font> font = painter.font();
            font.setBold(true);
            font.setUnderline(true);
            painter.setFont(font);
            painter.drawText(<font color=blue>new</font> <font color=darkmagenta><i>QPointF</i></font>(rectangle.x() + 10, rectangle.y() + 20),
                             <font color=darkgreen><i>"Svg Cards"</i></font>);

            painter.restore();

            painter.drawText(<font color=blue>new</font> <font color=darkmagenta><i>QPointF</i></font>(rectangle.x() + 20, rectangle.y() + 40),
                             status);
        }

        <font color=blue>void</font> cardMoving(String card) {
            status = <font color=darkgreen><i>"Moving : "</i></font> + card;
        }

        <font color=blue>void</font> cardStopped(String card) {
            status = <font color=darkgreen><i>"Dropped : "</i></font> + card;
        }

        <font color=blue>void</font> cardInfo(String info) {
            status = info;
        }
    }

    <font color=blue>private</font> <font color=blue>static</font> <font color=blue>class</font> CardDeck <font color=blue>extends</font> <font color=darkmagenta><i>QObject</i></font> {
        <font color=blue>private</font> <font color=darkmagenta><i>QSvgRenderer</i></font> renderer;
        <font color=blue>private</font> String fileName;
        <font color=blue>private</font> List&lt;Card&gt; cards;

        <font color=blue>public</font> CardDeck(String file, <font color=darkmagenta><i>QObject</i></font> parent) {
            <font color=blue>super</font>(parent);

            fileName = file;
            renderer = <font color=blue>new</font> <font color=darkmagenta><i>QSvgRenderer</i></font>(fileName, parent);
            cards = <font color=blue>new</font> LinkedList&lt;Card&gt;();
            <font color=blue>for</font> (<font color=blue>int</font> i = 0; i &lt; CARDS.length; ++i) {
                Card item = <font color=blue>new</font> Card(CARDS[i], renderer);
                cards.add(item);
            }

        }

        <font color=blue>public</font> List&lt;Card&gt; cards() {
            <font color=blue>return</font> cards;
        }
    }

    <font color=blue>private</font> <font color=blue>static</font> <font color=blue>class</font> CardManager <font color=blue>extends</font> <font color=darkmagenta><i>QObject</i></font> {
        <font color=blue>private</font> CardBox box;

        <font color=blue>public</font> <font color=blue>void</font> setBox(CardBox newBox) {
            box = newBox;
        }

        <font color=blue>public</font> <font color=blue>void</font> startedMove(Card card) {
            box.cardMoving(card.cardName());
            box.update(box.boundingRect());
        }

        <font color=blue>public</font> <font color=blue>void</font> stoppedMove(Card card) {
            box.cardStopped(card.cardName());
            box.update(box.boundingRect());
        }

        <font color=blue>public</font> <font color=blue>void</font> setOperation(String operation) {
            box.cardInfo(operation);
            box.update(box.boundingRect());
        }
    }

    <font color=blue>private</font> CardDeck deck;
    <font color=blue>private</font> CardManager manager;
    <font color=blue>private</font> Random random;
    <font color=blue>private</font> <font color=blue>int</font> cardsToLoad = 13;
    <font color=blue>private</font> <font color=blue>int</font> totalCards = cardsToLoad;
    <font color=blue>private</font> <font color=blue>int</font> x = 100;
    <font color=blue>private</font> <font color=blue>int</font> y = 100;
    <font color=blue>private</font> <font color=darkmagenta><i>QGraphicsScene</i></font> scene;

    <font color=blue>public</font> <font color=blue>final</font> <font color=blue>void</font> loadCards() {
        <font color=blue>if</font> (cardsToLoad != 0 && !closing) {
            addCard(random.nextInt(50));
            --cardsToLoad;
            <font color=blue>if</font> (cardsToLoad != 0) {
                <font color=blue>double</font> percent = (totalCards - cardsToLoad)
                                 / (<font color=blue>double</font>) totalCards * 100.0;
                manager.setOperation(<font color=darkgreen><i>"Loading Cards : "</i></font> + (<font color=blue>int</font>) percent + <font color=darkgreen><i>"% "</i></font>);
            } <font color=blue>else</font> {
                manager.setOperation(<font color=darkgreen><i>"Click on a Card"</i></font>);
            }
            viewport().update();
            <font color=darkmagenta><i>QApplication</i></font>.invokeLater(<font color=blue>new</font> Runnable() {
                <font color=blue>public</font> <font color=blue>void</font> run() { loadCards(); } });
        }
    }

    <font color=blue>public</font> SvgCards() {
        scene = <font color=blue>new</font> <font color=darkmagenta><i>QGraphicsScene</i></font>(<font color=blue>this</font>);
        setScene(scene);

        deck = <font color=blue>new</font> CardDeck(<font color=darkgreen><i>"classpath:com/trolltech/images/svg-cards.svg"</i></font>,
                            <font color=blue>this</font>);
        manager = <font color=blue>new</font> CardManager();
        random = <font color=blue>new</font> Random();

        CardBox box = <font color=blue>new</font> CardBox();
        box.setPos(sceneRect().width() - box.boundingRect().width() - 10,
                   sceneRect().height()- box.boundingRect().height() - 10);
        box.setZValue(99);
        scene.addItem(box);
        manager.setBox(box);

        setWindowIcon(<font color=blue>new</font> <font color=darkmagenta><i>QIcon</i></font>(<font color=darkgreen><i>"classpath:com/trolltech/images/qt-logo.png"</i></font>));
        setWindowTitle(<font color=darkgreen><i>"SVG Cards Example"</i></font>);

        <font color=darkmagenta><i>QLinearGradient</i></font> grad = <font color=blue>new</font> <font color=darkmagenta><i>QLinearGradient</i></font>(0, 0, 800, 600);
        grad.setColorAt(0, <font color=darkmagenta><i>QColor</i></font>.fromRgbF(0.5, 0.5, 0.7));
        grad.setColorAt(1, <font color=darkmagenta><i>QColor</i></font>.fromRgbF(1, 1, 1));
        setRenderHint(<font color=darkmagenta><i>QPainter</i></font>.RenderHint.Antialiasing);
        setBackgroundBrush(<font color=blue>new</font> <font color=darkmagenta><i>QBrush</i></font>(grad));
        setFrameStyle(<font color=darkmagenta><i>QFrame</i></font>.Shape.NoFrame.value());

        <font color=darkmagenta><i>QPixmapCache</i></font>.setCacheLimit(5 * 1024);

        <font color=darkmagenta><i>QApplication</i></font>.invokeLater(<font color=blue>new</font> Runnable() {
                    <font color=blue>public</font> <font color=blue>void</font> run() { loadCards(); } });
    }

    @Override
    <font color=blue>public</font> <font color=darkmagenta><i>QSize</i></font> sizeHint() {
        <font color=blue>return</font> <font color=blue>new</font> <font color=darkmagenta><i>QSize</i></font>(800, 600);
    }

    <font color=blue>private</font> <font color=blue>final</font> <font color=blue>void</font> addCard(<font color=blue>int</font> i) {
        Card item = deck.cards().get(i);
        <font color=blue>while</font> (item.scene() != null) {
            item = deck.cards().get(random.nextInt(50));
        }

        item.rotate(0 + 180.0 * random.nextDouble());
        <font color=blue>double</font> scaleF = 0.5 + 0.9 * random.nextDouble();
        item.scale(scaleF, scaleF);
        x += 80;
        <font color=blue>if</font> (x &gt;= 650) {
            x = 100;
            y += 100;
        }
        item.setPos(x, y);
        item.setFlag(<font color=darkmagenta><i>QGraphicsItem</i></font>.GraphicsItemFlag.ItemIsMovable, true);
        item.setManager(manager);
        scene().addItem(item);
    }

    <font color=blue>public</font> <font color=blue>static</font> <font color=blue>void</font> main(String args[]) {
        <font color=darkmagenta><i>QApplication</i></font>.initialize(args);

        SvgCards view = <font color=blue>new</font> SvgCards();
        view.show();

        <font color=darkmagenta><i>QApplication</i></font>.exec();
    }

    <font color=blue>public</font> <font color=blue>static</font> <font color=blue>boolean</font> notWebstart() {
        <font color=blue>return</font> System.getProperty(<font color=darkgreen><i>"com.trolltech.launcher.webstart"</i></font>) == null;
    }
}
</html></pre><p /><address><hr /><div align="center">
 <table width="100%" cellspacing="0" border="0"><tr class="address">
 <td width="30%">Copyright &copy; 2009 Nokia Corporation and/or its subsidiary(-ies)</td>
 <td width="40%" align="center"><a href="trademarks.html">Trademarks</a></td>
 <td width="30%" align="right"><div align="right">Qt Jambi 4.5.2_01</div></td>
 </tr></table></div></address></body></html>
