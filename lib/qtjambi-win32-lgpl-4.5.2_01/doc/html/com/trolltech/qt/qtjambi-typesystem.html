<?xml version="1.0" encoding="iso-8859-1"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
<title>The Qt Jambi Type System</title><link href="classic.css" rel="stylesheet" type="text/css" />
</head><table border="0" cellpadding="0" cellspacing="0" width="100%">
 <tr>
 <td align="left" valign="top" width="32"> <img src="images/qt-logo.png" align="left" width="32" height="32" border="0" /> </td>
 <td width="1">&nbsp;&nbsp;</td> <td class="postheader" valign="center"> <a href="qtjambi-index.html"> <font color="#004faf">Home</font></a>&nbsp;&middot; <a href="qtjambi-examples.html"> <font color="#004faf">Examples</font></a>&nbsp; </td>
 </tr></table><body><p><hr><p><center><h1>The Qt Jambi Type System</h1></center><p> The type system is used when mapping a C++ based library onto a corresponding Java library using the <a href="qtjambi-generator.html">Qt Jambi generator</a>. <p>The developer can define the scope of the Java API by writing a type system specification. The specification is a handwritten XML document listing the types that will be available in the generated Java API; types that are not declared in the specification will be ignored along with everything that depends on them. In addition, it is possible to manipulate and modify the types and functions. It is even possible to use the type system specification to inject arbitrary code into the source files, such as an extra member function. <p>The type system specification is passed as an argument to the <a href="qtjambi-generator.html">generator</a>. <p>Below is a complete reference guide to the various nodes of the type system. For examples of use, take a look at the type system files used to generate the Qt Jambi API. These files can be found in the <tt>generator</tt> directory of the Qt Jambi package. <ul><li> <a href="#alphabetical-list">Alphabetical List</a></li><li> <a href="#specifying-types">Specifying Types</a></li> <ul><li> <a href="#value-type-requirements">Value Type Requirements</a></li><li> <a href="#manipulating-object-and-value-types">Manipulating Object and Value Types</a></li><li> <a href="#manipulating-namespace-and-interface-types">Manipulating Namespace and Interface Types</a></li><li> <a href="#manipulating-enum-types">Manipulating Enum Types</a></li></ul><li> <a href="#modifying-functions">Modifying Functions</a></li> <ul><li> <a href="#modifying-arguments">Modifying Arguments</a></li></ul><li> <a href="#using-code-templates">Using Code Templates</a></li></ul> See also: <a href="qtjambi-generatorexample.html">Qt Jambi Generator Example</a><a name="alphabetical-list"><h2>Alphabetical List</h2> <a href="qtjambi-typesystem.html#access">access</a>, <a href="qtjambi-typesystem.html#argument-map">argument-map</a>, <a href="qtjambi-typesystem.html#conversion-rule">conversion-rule</a>, <a href="qtjambi-typesystem.html#custom-constructor">custom-constructor</a>, <a href="qtjambi-typesystem.html#custom-destructor">custom-destructor</a>, <a href="qtjambi-typesystem.html#define-ownership">define-ownership</a>, <a href="qtjambi-typesystem.html#enum-type">enum-type</a>, <a href="qtjambi-typesystem.html#extra-includes">extra-includes</a>, <a href="qtjambi-typesystem.html#include">include</a>, <a href="qtjambi-typesystem.html#inject-code">inject-code</a>, <a href="qtjambi-typesystem.html#insert-template">insert-template</a>, <a href="qtjambi-typesystem.html#interface-type">interface-type</a>, <a href="qtjambi-typesystem.html#load-typesystem">load-typesystem (multiple type system)</a>, <a href="qtjambi-typesystem.html#modify-argument">modify-argument</a>, <a href="qtjambi-typesystem.html#modify-field">modify-field</a>, <a href="qtjambi-typesystem.html#modify-function">modify-function</a>, <a href="qtjambi-typesystem.html#namespace-type">namespace-type</a>, <a href="qtjambi-typesystem.html#object-type">object-type</a>, <a href="qtjambi-typesystem.html#primitive-type">primitive-type</a>, <a href="qtjambi-typesystem.html#reject-enum-value">reject-enum-value</a>, <a href="qtjambi-typesystem.html#rejection">rejection</a>, <a href="qtjambi-typesystem.html#remove">remove</a>, <a href="qtjambi-typesystem.html#remove-argument">remove-argument</a>, <a href="qtjambi-typesystem.html#remove-default-expression">remove-default-expression</a>, <a href="qtjambi-typesystem.html#rename">rename</a>, <a href="qtjambi-typesystem.html#replace">replace</a>, <a href="qtjambi-typesystem.html#replace-default-expression">replace-default-expression</a>, <a href="qtjambi-typesystem.html#replace-type">replace-type</a>, <a href="qtjambi-typesystem.html#suppress-warning">suppress-warning</a>, template, <a href="qtjambi-typesystem.html#typesystem">typesystem</a>, <a href="qtjambi-typesystem.html#value-type">value-type</a><a name="specifying-types"><h2>Specifying Types</h2> <br><center><img src="images/typesystem-root.png"></center><br> <table align="center" border="0" cellpadding="2" cellspacing="1" width="100%"><thead><tr class="qt-style" valign="top"><th><center> Node</center></th><th><center> Description</center></th></tr></thead><tr valign="top" class="even"><td> <b>typesystem</b><a name="typesystem"></td><td> The <tt>typesystem</tt> node is the root node containing all the type system information.<pre>&lt;typesystem package="..."
    default-superclass="..." (optional)&gt;
&lt;/typesystem&gt;</pre> The <tt>package</tt> attribute is a string describing the package to be used, e.g.,<tt>"com.trolltech.qt.core"</tt>. The optional <tt>default-superclass</tt> attribute is the complete class name of the default baseclass of all objects in Java, e.g., <tt>"com.trolltech.qt.QtJambiObject"</tt>.</td></tr><tr valign="top" class="odd"><td> <b>load-typesystem</b><a name="load-typesystem"></td><td> The <tt>load-typesystem</tt> node specifies which type systems to load when mapping multiple libraries to Java or basing one library on another, and is a child of the <a href="qtjambi-typesystem.html#typesystem">typesystem</a> node.<pre>&lt;typesystem ...&gt;
    &lt;load-typesystem name="..."
        generate="yes | no"&gt;
&lt;/typesystem&gt;</pre> The <tt>name</tt> attribute is the filename of the type system to load, the <tt>generate</tt> attribute specifies whether code should be generated or not. The latter must be specified when basing one library on another, making the generator able to understand inheritance hierarchies, primitive mapping, parameter types in functions etc. <p>Most libraries will be based on both the <a href="qtcore.html">QtCore</a> and <a href="qtgui.html">QtGui</a> modules, in which case code generation for these libraries will be disabled.</td></tr><tr valign="top" class="even"><td> <b>rejection</b><a name="rejection"></td><td> The <tt>rejection</tt> node rejects the given class, or the specified function or field, and is a child of the <a href="qtjambi-typesystem.html#typesystem">typesystem</a> node.<pre>&lt;typesystem ...&gt;
    &lt;rejection class="..."
        function-name="..." (optional)
        field-name="..." (optional) /&gt;
&lt;/typesystem&gt;</pre> The <tt>class</tt> attribute is the C++ class name of the class to reject. Use the optional <tt>function-name</tt> or <tt>field-name</tt> attributes to reject a particular function or field. Note that the <tt>field-name</tt> and <tt>function-name</tt> cannot be specified at the same time. To remove all occurrences of a given field or function, set the <tt>class</tt> attribute to <tt>*</tt>.</td></tr><tr valign="top" class="odd"><td> <b>primitive-type</b><a name="primitive-type"></td><td> The <tt>primitive-type</tt> node describes how a primitive type is mapped from C++ to Java and the Java Native Interface (JNI), and is a child of the <a href="qtjambi-typesystem.html#typesystem">typesystem</a> node. Note that most primitives are already specified in the <a href="qtcore.html">QtCore</a> type system.<pre>&lt;typesystem ...&gt;
    &lt;primitive-type name="..."
        java-name="..." (optional)
        jni-name="..." (optional)
        preferred-conversion="yes | no" (optional)&gt;
&lt;/typesystem&gt;</pre> The <tt>name</tt> attribute is the name of the primitive in C++, the <tt>java-name</tt> attribute is the name of the primitive in Java, and the <tt>jni-name</tt> attribute is the name of the primitive in JNI. If the latter two attributes are not specified, their default value will be the same as the <tt>name</tt> attribute. <p>If the optional <tt>preferred-conversion</tt> attribute is set to "no", it indicates that this version of the primitive is not the preferred C++ equivalent of the Java type. For example, both "qint64" and "long long" become "long" in Java but we should prefer the "qint64" version. For this reason we mark "long long" with <tt>preferred-conversion="no"</tt>.</td></tr><tr valign="top" class="even"><td> <b>namespace-type</b><a name="namespace-type"></td><td> The <tt>namespace-type</tt> node maps the given C++ namespace to Java ( note that the namespace becomes an interface in Java), and is a child of the <a href="qtjambi-typesystem.html#typesystem">typesystem</a> node. Note that within namespaces, the generator only supports enums (i.e., no functions or classes).<pre>&lt;typesystem ...&gt;
    &lt;namespace-type name="..."
        package="..." (optional)
        expense-cost="..." (opt)
        expense-limit="..." (opt)/&gt;
&lt;/typesystem&gt;</pre> The <tt>name</tt> attribute is the name of the namespace, e.g., "Qt". The <tt>package</tt> attribute can be used to override the package of the type system.<a name="expense"> The <tt>expense-cost</tt> attribute specifies the memory cost of using an instance of the given type, allowing the garbage collector to optimize the memory management. The cost is specified using Java code. The <tt>expense-limit</tt> attribute specifies how much an instance's memory consumption must be before the garbage collector is activated (the memory consumption is calculated using the value of the <tt>expense-cost</tt> attribute).</td></tr><tr valign="top" class="odd"><td> <b>enum-type</b><a name="enum-type"></td><td> The <tt>enum-type</tt> node maps the given enum from C++ to Java, and is a child of the <a href="qtjambi-typesystem.html#typesystem">typesystem</a> node. Use the <a href="qtjambi-typesystem.html#reject-enum-value">reject-enum-value</a> to reject values.<pre>&lt;typesystem ...&gt;
    &lt;enum-type name="..."
        flags="yes | no" (optional)
        lower-bound="..." (optional)
        upper-bound="..." (optional)
        force-integer="yes | no" (optional)
        extensible="yes | no" (optional)/&gt;
&lt;/typesystem&gt;</pre> The <tt>name</tt> attribute is the fully qualified C++ name of the enum (e.g.,"<a href="../../../com/trolltech/qt/core/Qt.FillRule.html">Qt::FillRule</a>"). If the optional <tt>flags</tt> attribute is set to <tt>yes</tt> (the default is <tt>no</tt>), the generator will expect an existing QFlags&lt;T&gt; for the given enum type. The <tt>lower-bound</tt> and <tt>upper-bound</tt> attributes are used to specify runtime boundschecking for the enum value. The value must be a compilable java statement, such as "<a href="../../../com/trolltech/qt/gui/QGradient.html">QGradient</a>.Spread.PadSpread". If the <tt>force-integer</tt> attribute is set to <tt>yes</tt> (the default is <tt>no</tt>), the generated Java code will use integers instead of Java enums. And finally, the <tt>extensible</tt> attribute specifies whether the given enum can be extended with user values (the default is <tt>no</tt>).</td></tr><tr valign="top" class="even"><td> <b>value-type</b><a name="value-type"></td><td> The <tt>value-type</tt> node indicates that the given C++ type is mapped onto Java as a value type, and is a child of the <a href="qtjambi-typesystem.html#typesystem">typesystem</a> node.<pre>&lt;typesystem ...&gt;
    &lt;value-type  name="..."
        package ="..." (optional)
        default-superclass ="..." (optional)
        polymorphic-base="yes | no" (opt)
        polymorphic-id-expression="..." (opt)
        expense-cost="..." (opt)
        expense-limit="..." (opt)/&gt;
&lt;/typesystem&gt;</pre> The <tt>name</tt> attribute is the fully qualified C++ class name, such as "<a href="../../../com/trolltech/qt/gui/QMatrix.html">QMatrix</a>" or "QPainterPath::Element". The <tt>package</tt> attribute can be used to override the package of the type system. If there is no C++ base class, the <tt>default-superclass</tt> attribute can be used to specify a superclass for the given type, in the generated Java API. <p>The <tt>polymorphic-base</tt> and <tt>polymorphic-id-expression</tt> attributes have the same meaning as the <a href="qtjambi-typesystem.html#polymorphic">object-type</a> node, and the <tt>expense-cost</tt> and <tt>expense-limit</tt> attributes have the same meaning as for the <a href="qtjambi-typesystem.html#expense">namespace-type</a> node.</td></tr><tr valign="top" class="odd"><td> <b>object-type</b><a name="object-type"></td><td> The <tt>object-type</tt> node indicates that the given C++ type is mapped onto Java as an object type, and is a child of the <a href="qtjambi-typesystem.html#typesystem">typesystem</a> node.<pre>&lt;typesystem ...&gt;
    &lt;object-type name="..."
        package ="..." (optional)
        default-superclass ="..." (optional)
        polymorphic-base="yes | no" (opt)
        polymorphic-id-expression="..." (opt)
        expense-cost="..." (opt)
        expense-limit="..." (opt)/&gt;
&lt;/typesystem&gt;</pre> The <tt>name</tt> attribute is the fully qualified C++ class name. The <tt>package</tt> attribute can be used to override the package of the type system. If there is no C++ base class, the <tt>default-superclass</tt> attribute can be used to specify a superclass for the given type, in the generated Java API.<a name="polymorphic"> The <tt>polymorphic-base</tt> attribute is used to specify the base class for polymorphic types that do not inherit <a href="../../../com/trolltech/qt/core/QObject.html">QObject</a> (like <a href="../../../com/trolltech/qt/core/QEvent.html">QEvent</a>), i.e. types that do not support introspection. By specifying the base class, introspection is enabled, provided that the subclasses sets the <tt>polymorphic-id-expression</tt> attribute. For example:<pre>&lt;object-type name="QEvent" polymorphic-base="yes" /&gt;
&lt;object-type name="QTimerEvent"
             polymorphic-id-expression="%1-&gt;type() == QEvent::Timer)" /&gt;</pre> The <tt>polymorphic-id-expression</tt> attribute specifies code that determines which subclass, in a polymorphic hierarchy, an object belongs to. Instances of <tt>%1</tt> in the code will be replaced by the name of the object in question. <p>The <tt>expense-cost</tt> and <tt>expense-limit</tt> attributes have the same meaning as for the <a href="qtjambi-typesystem.html#expense">namespace-type</a> node.</td></tr><tr valign="top" class="even"><td> <b>interface-type</b><a name="interface-type"></td><td> The <tt>interface-type</tt> node indicates that the given class is replaced by an interface pattern when mapping from C++ to Java. It is used to resolve multiple base classes which is not supported by Java. Using the <tt>interface-type</tt> node implicitly makes the given type an <a href="qtjambi-typesystem.html#object-type">object type</a>.<pre>&lt;typesystem ...&gt;
    &lt;interface-type name="..."
        package ="..." (optional)
        default-superclass ="..." (optional)
        polymorphic-base="yes | no" (opt)
        polymorphic-id-expression="..." (opt)
        expense-cost="..." (opt)
        expense-limit="..." (opt)/&gt;
&lt;/typesystem&gt;</pre> The <tt>name</tt> attribute is the fully qualified C++ class name. The <tt>package</tt> attribute can be used to override the package of the type system. If there is no C++ base class, the <tt>default-superclass</tt> attribute can be used to specify a superclass in the generated Java API, for the given class. <p>The <tt>polymorphic-base</tt> and <tt>polymorphic-id-expression</tt> attributes have the same meaning as the <a href="qtjambi-typesystem.html#polymorphic">object-value</a> node, and the <tt>expense-cost</tt> and <tt>expense-limit</tt> attributes have the same meaning as for the <a href="qtjambi-typesystem.html#expense">namespace-type</a> node.</td></tr><tr valign="top" class="odd"><td> <b>suppress-warning</b><a name="suppress-warning"></td><td> The generator will generate several warnings which may be irrelevant to the user. The <tt>suppress-warning</tt> node suppresses the specified warning, and is a child of the <a href="qtjambi-typesystem.html#typesystem">typesystem</a> node.<pre>&lt;typesystem...&gt;
    &lt;suppress-warning text="..." /&gt;
&lt;/typesystem&gt;</pre> The <tt>text</tt> attribute is the warning text to suppress, and may contain the <tt>*</tt> wildcard (use "" to escape regular expression matching if the warning contain a regular "*").</td></tr><tr valign="top" class="even"><td> <b>template</b><a name="template"></td><td> The <tt>template</tt> node registers a template that can be used to avoid duplicate code when extending the generated code, and is a child of the <a href="qtjambi-typesystem.html#typesystem">typesystem</a> node.<pre>&lt;typesystem&gt;
    &lt;template name="my_template"&gt;
        // the code
    &lt;/template&gt;
&lt;/typesystem&gt;</pre> Use the <a href="qtjambi-typesystem.html#insert-template">insert-template</a> node to insert the template code (identified by the template's <tt>name</tt> attribute) into the generated code base.</td></tr></table><a name="value-type-requirements"><h3>Value Type Requirements</h3> <br><center><img src="images/typesystem-valuetype.png"></center><br> <table align="center" border="0" cellpadding="2" cellspacing="1" width="100%"><thead><tr class="qt-style" valign="top"><th><center> Node</center></th><th><center> Description</center></th></tr></thead><tr valign="top" class="even"><td> <b>custom-constructor</b><a name="custom-constructor"></td><td> In Java, value types are required to have a copy constructor. If a C++ class without a copy constructor is mapped onto Java as a value type, it is possible to provide a custom constructor using the <tt>custom-constructor</tt> node which is a child of the <tt>value-type</tt> node.<pre>&lt;value-type ...&gt;
    &lt;custom-constructor
         name="..." (optional)
         param-name="..." (optional)&gt;
            // code for custom constructor
    &lt;/custom-constructor&gt;
&lt;/value-type&gt;</pre> The custom constructor's signature becomes:<pre> T *name(T *param-name);</pre> If not specified the name of the constructor becomes <tt>&lt;lowercase type name&gt;_create()</tt> and the parameter name becomes <tt>copy</tt>.</td></tr><tr valign="top" class="odd"><td> <b>custom-destructor</b><a name="custom-destructor"></td><td> When a custom constructor is provided using the <a href="qtjambi-typesystem.html#custom-constructor">custom-constructor</a> node, it is most likely required to clean up the allocated memory. For that reason, it is also possible to provide a custom destructor using the <tt>custom-destructor</tt> node which is a child of the <tt>value-type</tt> node.<pre>&lt;value-type ...&gt;
    &lt;custom-destructor
         name="..." (optional)
         param-name="..." (optional)&gt;
            // code for custom destructor
    &lt;/custom-destructor&gt;
&lt;/value-type&gt;</pre> The custom destructor must have the following signature:<pre> T *name(T *param-name);</pre> If not specified the name of the destructor becomes <tt>&lt;lowercase type name&gt;_delete()</tt> and the parameter name becomes <tt>copy</tt>.</td></tr><tr valign="top" class="even"><td> <b>insert-template</b></td><td> Documented in the <a href="qtjambi-typesystem.html#insert-template">Using Code Templates</a> section</td></tr></table><a name="manipulating-object-and-value-types"><h3>Manipulating Object and Value Types</h3> <br><center><img src="images/typesystem-manipulatingtypes.png"></center><br> <table align="center" border="0" cellpadding="2" cellspacing="1" width="100%"><thead><tr class="qt-style" valign="top"><th><center> Node</center></th><th><center> Description</center></th></tr></thead><tr valign="top" class="even"><td> <b>inject-code</b><a name="inject-code"></td><td> The <tt>inject-code</tt> node inserts the given code into the generated code for the given type or function, and is a child of the <a href="qtjambi-typesystem.html#object-type">object-type</a>, <a href="qtjambi-typesystem.html#value-type">value-type</a> and <a href="qtjambi-typesystem.html#modify-function">modify-function</a> nodes.<pre> &lt;value-type ...&gt;
     &lt;inject-code class="java | native | shell | shell-declaration"
         position="beginning | end"&gt;
         // the code
     &lt;/inject-code&gt;
 &lt;/value-type&gt;</pre> The <tt>class</tt> attribute specifies which module of the generated code that will be affected by the code injection. The <tt>class</tt> attribute accepts the following values: <ul><li> <tt>java</tt>: The generated java code</li><li> <tt>native</tt>: The generated JNI-based methods</li><li> <tt>shell</tt>: The generated shell class</li><li> <tt>shell-declaration</tt>: The code will be injected into the generated header file containing the shell class definition.</li></ul> If the position attribute is set to <tt>beginning</tt> (the default), the code is inserted at the beginning of the function. If it is set to <tt>end</tt>, the code is inserted at the end of the function.</td></tr><tr valign="top" class="odd"><td> <b>modify-field</b><a name="modify-field"></td><td> The <tt>modify-field</tt> node allows you to alter the access privileges for a given C++ field when mapping it onto Java, and is a child of an <a href="qtjambi-typesystem.html#object-type">object-type</a> or a <a href="qtjambi-typesystem.html#value-type">value-type</a> node.<pre> &lt;object-type ...&gt;
     &lt;modify-field name="..."
         write="true | false" (optional)
         read="true | false" (optional)/&gt;
 &lt;/object-type&gt;</pre> The <tt>name</tt> attribute is the name of the field, the optional <tt>write</tt> and <tt>read</tt> attributes specify the field's access privileges in the Java API (both are set to <tt>true</tt> by default).</td></tr><tr valign="top" class="even"><td> <b>modify-function</b><a name="modify-function"></td><td> The <tt>modify-function</tt> node allows you to modify a given C++ function when mapping it onto Java, and is a child of an <a href="qtjambi-typesystem.html#object-type">object-type</a> or a <a href="qtjambi-typesystem.html#value-type">value-type</a> node. Use the <a href="qtjambi-typesystem.html#modify-argument">modify-argument</a> node to specify which argument the modification affects.<pre> &lt;object-type ...&gt;
     &lt;modify-function signature="..."
                      remove="all | java"
                      access="public | private | protected"
                      rename="..." &gt;
 &lt;/object-type&gt;</pre> The <tt>signature</tt> attribute is a normalized C++ signature, excluding return values but including potential <tt>const</tt> declarations. <p>The <tt>remove</tt>, <tt>access</tt> and <tt>rename</tt> attributes are optional attributes for added convenience; they serve the same purpose as the tags <a href="qtjambi-typesystem.html#remove">remove</a>, <a href="qtjambi-typesystem.html#access">access</a> and <a href="qtjambi-typesystem.html#rename">rename</a>.</td></tr><tr valign="top" class="odd"><td> <b>include</b></td><td> Documented in the <a href="qtjambi-typesystem.html#include">Manipulating Namespace and Interface Types</a> section</td></tr><tr valign="top" class="even"><td> <b>extra-includes</b></td><td> Documented in the <a href="qtjambi-typesystem.html#include">Manipulating Namespace and Interface Types</a> section</td></tr><tr valign="top" class="odd"><td> <b>insert-template</b></td><td> Documented in the <a href="qtjambi-typesystem.html#insert-template">Using Code Templates</a> section</td></tr><tr valign="top" class="even"><td> <b>delete-in-main-thread</b></td><td> Specifies that the object is tied to the main thread and can only be deleted in the application's main thread. This is true for all non-QObjects that use native windowing system resources, such as fonts, pixmaps, and <a href="../../../com/trolltech/qt/gui/QGraphicsItem.html">QGraphicsItem</a>s. It is also true classes that memory manage objects of these classes.</td></tr></table><a name="manipulating-namespace-and-interface-types"><h3>Manipulating Namespace and Interface Types</h3> <br><center><img src="images/typesystem-manipulating-namespaces-and-interfaces.png"></center><br> <table align="center" border="0" cellpadding="2" cellspacing="1" width="100%"><thead><tr class="qt-style" valign="top"><th><center> Node</center></th><th><center> Description</center></th></tr></thead><tr valign="top" class="even"><td> <b>extra-includes</b><a name="extra-includes"></td><td> The <tt>extra-includes</tt> node contains declarations of additional include files, and can be a child of the <a href="qtjambi-typesystem.html#interface-type">interface-type</a>, <a href="qtjambi-typesystem.html#namespace-type">namespace-type</a>, <a href="qtjambi-typesystem.html#value-type">value-type</a> and <a href="qtjambi-typesystem.html#object-type">object-type</a> nodes. <p>The generator automatically tries to read the global header for each type. But sometimes it is required to include extra files in the generated C++ code to make sure that the code compiles. These files must be listed using <a href="qtjambi-typesystem.html#include">include</a> nodes witin the <tt>extra-include</tt> node:<pre> &lt;value-type ...&gt;
     &lt;extra-includes&gt;
         &lt;include file-name="..." location="global | local | java"/&gt;
     &lt;/extra-includes&gt;
 &lt;/value-type&gt;</pre> The <tt>file-name</tt> attribute is the file to include, such as "QStringList". The <tt>location</tt> attribute is where the file is located: <tt>global</tt> means that the file is located in <tt>$INCLUDEPATH</tt> and will be included using <tt>#include &lt;...&gt;</tt>, <tt>local</tt> means that the file is in a local directory and will be included using <tt>#include "..."</tt>. If the <tt>location</tt> is set to <tt>java</tt> then the <tt>file-name</tt> attribute is expected to contain the fully qualified name for a java class and the specified class will be imported in the generated java code.</td></tr><tr valign="top" class="odd"><td> <b>include</b><a name="include"></td><td> The <tt>include</tt> node specifies the name and location of a file that must be included, and is a child of the <a href="qtjambi-typesystem.html#interface-type">interface-type</a>, <a href="qtjambi-typesystem.html#namespace-type">namespace-type</a>, <a href="qtjambi-typesystem.html#value-type">value-type</a>, <a href="qtjambi-typesystem.html#object-type">object-type</a> or <a href="qtjambi-typesystem.html#extra-includes">extra-includes</a> nodes <p>The generator automatically tries to read the global header for each type. Use the <tt>include</tt> node to override this behavior, providing an alternative file. The <tt>include</tt> node can also be used to specify <a href="qtjambi-typesystem.html#extra-includes">extra include files</a>.<pre> &lt;value-type ...&gt;
     &lt;include file-name="..."
         location="global | local | java"/&gt;
 &lt;/value-type&gt;</pre> The <tt>file-name</tt> attribute is the file to include, such as "QStringList". The <tt>location</tt> attribute is where the file is located: <tt>global</tt> means that the file is located in <tt>$INCLUDEPATH</tt> and will be included using <tt>#include &lt;...&gt;</tt>, <tt>local</tt> means that the file is in a local directory and will be included using <tt>#include "..."</tt>. If the <tt>location</tt> attribute is set to <tt>java</tt> in this particular case, it will be ignored.</td></tr></table><a name="manipulating-enum-types"><h3>Manipulating Enum Types</h3> <br><center><img src="images/typesystem-manipulatingenums.png"></center><br> <table align="center" border="0" cellpadding="2" cellspacing="1" width="100%"><thead><tr class="qt-style" valign="top"><th><center> Node</center></th><th><center> Description</center></th></tr></thead><tr valign="top" class="even"><td> <b>reject-enum-value</b><a name="reject-enum-value"></td><td> The <tt>reject-enum-value</tt> node rejects the enum value specified by the <tt>name</tt> attribute, and is a child of the <a href="qtjambi-typesystem.html#enum-type">enum-type</a> node.<pre> &lt;enum-type ...&gt;
     &lt;reject-enum-value name="..."/&gt;
 &lt;/enum-type&gt;</pre> This node is used when a C++ enum implementation has several identical numeric values, some of which are typically obsolete.</td></tr></table><a name="modifying-functions"><h2>Modifying Functions</h2> <br><center><img src="images/typesystem-modifyfunction.png"></center><br> <table align="center" border="0" cellpadding="2" cellspacing="1" width="100%"><thead><tr class="qt-style" valign="top"><th><center> Node</center></th><th><center> Description</center></th></tr></thead><tr valign="top" class="even"><td> <b>modify-argument</b><a name="modify-argument"></td><td> The <tt>modify-argument</tt> node specifies which of the given function's arguments the modification affects, and is a child of the <a href="qtjambi-typesystem.html#modify-function">modify-function</a> node. Use the <a href="qtjambi-typesystem.html#remove-argument">remove-argument</a>, <a href="qtjambi-typesystem.html#replace-default-expression">replace-default-expression</a>, <a href="qtjambi-typesystem.html#remove-default-expression">remove-default-expression</a>, <a href="qtjambi-typesystem.html#replace-type">replace-type</a>, <a href="qtjambi-typesystem.html#reference-count">reference-count</a> and <a href="qtjambi-typesystem.html#define-ownership">define-ownership</a> nodes to specify the details of the modification.<pre> &lt;modify-function ...&gt;
     &lt;modify-argument index="return | this | 1 ..."
          invalidate-after-use="yes | no" (optional) &gt;
         modifications
     &lt;/modify-argument&gt;
 &lt;/modify-function&gt;</pre> Set the <tt>index</tt> attribute to "1" for the first argument, "2" for the second one and so on. Alternatively, set it to "return" or "this" if you want to modify the function's return value or the object the function is called upon, respectively. <p>The <tt>invalidate-after-use</tt> attribute is optional and defaults to "no". Setting it to "yes" is only applicable for modifications to virtual functions and will cause the Java object passed as the argument to be invalidated after the virtual function call is complete, if the object is owned by C++ and not by Java. This is used as a measure against crashes caused by users retaining references to objects that are later deleted in the underlying C++ code.</td></tr><tr valign="top" class="odd"><td> <b>remove</b><a name="remove"></td><td> The <tt>remove</tt> node removes the given method from the generated Java code, and is a child of the <a href="qtjambi-typesystem.html#modify-function">modify-function</a> node.<pre> &lt;modify-function ...&gt;
     &lt;remove class="all | java" /&gt;
 &lt;/modify-function&gt;</pre> If the <tt>class</tt> attribute is set to "java", the function is only removed for the generated java code; the default value is "all".</td></tr><tr valign="top" class="even"><td> <b>access</b><a name="access"></td><td> The <tt>access</tt> node changes the access privileges of the given function in the generated Java code, and is a child of the <a href="qtjambi-typesystem.html#modify-function">modify-function</a> node.<pre> &lt;modify-function ...&gt;
     &lt;access modifier="public | protected | private"/&gt;
 &lt;/modify-function&gt;</pre></td></tr><tr valign="top" class="odd"><td> <b>rename</b><a name="rename"></td><td> The <tt>rename</tt> node changes the name of the given function in the generated Java code, and is a child of the <a href="qtjambi-typesystem.html#modify-function">modify-function</a> node.<pre> &lt;modify-function...&gt;
     &lt;rename to="..." /&gt;
 &lt;/modify-function&gt;</pre> The <tt>to</tt> attribute is the new name of the function.</td></tr><tr valign="top" class="even"><td> <b>inject-code</b></td><td> Documented in the <a href="qtjambi-typesystem.html#inject-code">Manipulating Types</a> section</td></tr><tr valign="top" class="odd"><td> <b>argument-map</b><a name="argument-map"></td><td> The <tt>argument-map</tt> node maps a C++ argument name to the argument name used in the generated Java code, and is a child of the <a href="qtjambi-typesystem.html#inject-code">inject-code</a> node when the latter is a child of a <a href="qtjambi-typesystem.html#modify-function">modify-function</a> node.<pre> &lt;modify-function...&gt;
     &lt;inject-code ...&gt;
         &lt;argument-map index="numeric value"
             meta-name="string value"&gt;
     &lt;/inject-code&gt;
 &lt;/modify-function&gt;</pre> The <tt>index</tt> attribute is an index, starting at 1, indicating the argument position to which this argument mapping applies. The <tt>meta-name</tt> attribute is the name used within the code injection to adress the argument at the given position.</td></tr></table><a name="modifying-arguments"><h3>Modifying Arguments</h3> <br><center><img src="images/typesystem-modifyargument.png"></center><br> <table align="center" border="0" cellpadding="2" cellspacing="1" width="100%"><thead><tr class="qt-style" valign="top"><th><center> Node</center></th><th><center> Description</center></th></tr></thead><tr valign="top" class="even"><td> <b>remove-argument</b><a name="remove-argument"></td><td> The <tt>remove-argument</tt> node removes the given argument from the function's signature, and is a child of the <a href="qtjambi-typesystem.html#modify-argument">modify-argument</a> node.<pre> &lt;modify-argument ...&gt;
     &lt;remove-argument /&gt;
 &lt;/modify-argument&gt;</pre> Typically, when removing an argument, some conversion rules must be specified, e.g., when converting from Java to C++. This can be done using the <a href="qtjambi-typesystem.html#conversion-rule">conversion-rule</a> node.</td></tr><tr valign="top" class="odd"><td> <b>remove-default-expression</b><a name="remove-default-expression"></td><td> The <tt>remove-default-expression</tt> node disables the use of the default expression for the given argument, and is a child of the <a href="qtjambi-typesystem.html#modify-argument">modify-argument</a> node.<pre> &lt;modify-argument...&gt;
     &lt;remove-default-expression /&gt;
 &lt;/modify-argument&gt;</pre></td></tr><tr valign="top" class="even"><td> <b>replace-default-expression</b><a name="replace-default-expression"></td><td> The <tt>replace-default-expression</tt> node replaces the specified argument with the expression specified by the <tt>with</tt> attribute, and is a child of the <a href="qtjambi-typesystem.html#modify-argument">modify-argument</a> node.<pre> &lt;modify-argument...&gt;
     &lt;replace-default-expression with="..." /&gt;
 &lt;/modify-argument&gt;</pre></td></tr><tr valign="top" class="odd"><td> <b>replace-type</b><a name="replace-type"></td><td> The <tt>replace-type</tt> node replaces the type of the given argument to the one specified by the <tt>modified-type</tt> attribute, and is a child of the <a href="qtjambi-typesystem.html#modify-argument">modify-argument</a> node.<pre> &lt;modify-argument...&gt;
     &lt;replace-type modified-type="..." /&gt;
 &lt;/modify-argument&gt;</pre> If the new type is a class, the <tt>modified-type</tt> attribute must be set to the fully qualified name (including name of the package as well as the class name). <p>Typically, when changing the type of an argument, some conversion rules must be specified. This can be done using the <a href="qtjambi-typesystem.html#conversion-rule">conversion-rule</a> node.</td></tr><tr valign="top" class="even"><td> <b>reference-count</b><a name="reference-count"></td><td> The <tt>reference-count</tt> tag indicates that the function holds a reference to the argument object without assuming ownership of it.<pre> &lt;modify-argument ...&gt;
     &lt;reference-count action="add | add-all | remove | set | ignore"
                      variable-name="..."
                      declare-variable="..."
                      conditional="..."
                      access="public | private | protected | friendly" /&gt;
 &lt;/modify-argument&gt;</pre> The <tt>action</tt> attribute specifies the action to be taken. <tt>add</tt>, <tt>add-all</tt> and <tt>remove</tt> are collection actions. They will add a single object to a list of references, add all objects in a collection to a list of references or remove a single object from a list of references. <tt>set</tt> will assign the argument to the variable containing the reference (the argument must be a collection if the variable is also used for any of the collection specific actions.) <tt>ignore</tt> will not inject any code, but will cause the method in question to be removed from the log of possible reference counting API. <p>The <tt>variable-name</tt> attribute specifies the name used for the variable that holds the reference(s). <p>The <tt>declare-variable</tt> attribute can be used to specify the fully qualified name of the class that owns the reference. This attribute is optional, and should only be specified if the variable should not be declared in the current class. The specified must be in the superclass hierarchy of the current class. <p>The <tt>conditional</tt> attribute is optional, and specifies a conditional expression which must be true in order for the action of the <tt>reference-count</tt> tag to be taken. <p>The <tt>access</tt> attribute gives the visibility of the variable. Only applicable if <tt>declare-variable</tt> is not specified. The default value of <tt>access</tt> is <tt>private</tt>.</td></tr><tr valign="top" class="odd"><td> <b>define-ownership</b><a name="define-ownership"></td><td> The <tt>define-ownership</tt> tag indicates that the function changes the ownership rules of the arguemnt object. The <tt>class</tt> attribute specifies the class of function in which to inject the ownership altering code. The <tt>owner</tt> attribute specifies the new ownership of the object. It accepts the following values: <ul><li> <tt>java</tt>: Java will assume full ownership of the object. The native resources will be deleted when the Java object is finalized.</li><li> <tt>c++</tt>: The native code assumes full ownership of the object. The Java object will not be garbage collected.</li><li> <tt>default</tt>: The object will get default ownership, depending on how it was created.</li></ul><pre> &lt;modify-argument ...&gt;
      &lt;define-ownership class="java | shell"
                        owner="java | c++ | default" /&gt;
 &lt;/modify-argument&gt;</pre></td></tr><tr valign="top" class="even"><td> <b>conversion-rule</b><a name="conversion-rule"></td><td> The <tt>conversion-rule</tt> node allows you to write customized code to convert the given argument between Java and C++, and is a child of the <a href="qtjambi-typesystem.html#modify-argument">modify-argument</a> node.<pre> &lt;modify-argument ...&gt;
      &lt;conversion-rule class="shell | native"&gt;
         // the code
      &lt;/conversion-rule&gt;
 &lt;/modify-argument&gt;</pre> This node is typically used in combination with the <a href="qtjambi-typesystem.html#replace-type">replace-type</a> and <a href="qtjambi-typesystem.html#remove-argument">remove-argument</a> nodes. The given code is used instead of the generator's conversion code in the following situations (defined by the <a href="qtjambi-typesystem.html#modify-argument">modify-argument</a> node's <tt>index</tt> attribute and the <tt>class</tt> attribute as well the function implementation and where the function is called from):    <table align="center" cellpadding="2" cellspacing="1" border="0">
        <tr valign="top" bgcolor="#a2c511">
            <th>Argument Index</th>
            <th>Function Class</th>
            <th>Function Implementation</th>
            <th>Caller Location</th>
         </tr>
         <tr valign="top" bgcolor="#f0f0f0">
             <td>1 | 2 ...</td>
             <td>shell</td>
             <td>Java (overriding C++)</td>
             <td>C++ </td>
         </tr>
         <tr valign="top" bgcolor="#e0e0e0">
             <td>1 | 2 ...</td>
             <td>native</td>
             <td>C++</td>
             <td>Java</td>
         </tr>
         <tr valign="top" bgcolor="#f0f0f0">
             <td>return</td>
             <td>shell</td>
             <td>C++</td>
             <td>Java</td>
         </tr>
         <tr valign="top" bgcolor="#e0e0e0">
             <td>return </td>
             <td>native</td>
             <td>Java (overriding C++)</td>
             <td>C++</td>
         </tr>

    </table>
     Writing <tt>%N</tt> in the code (where <tt>N</tt> is a number), will insert the name of the nth argument. Alternatively, <tt>%in</tt> and <tt>%out</tt> which will be replaced with the name of the conversion's input and output variable, respectively. Note the output variable must be declared explicitly, for example:<pre> &lt;conversion-rule class="native"&gt;
     bool %out = (bool) %in;
 &lt;/conversion-rule&gt;</pre></td></tr><tr valign="top" class="odd"><td> <b>insert-template</b></td><td> Documented in the <a href="qtjambi-typesystem.html#insert-template">Using Code Templates</a> section</td></tr><tr valign="top" class="even"><td> <b>replace-value</b><a name="replace-value"></td><td> The <tt>replace-value</tt> attribute lets you replace the return statement of a function with a fixed string. This attribute can only be used for the argument at index 0, which is always the function's return value. <p>Here is an example of how to use <tt>modify-argument</tt>:<pre> &lt;modify-argument index="0" replace-value="this"/&gt;</pre></td></tr></table><a name="using-code-templates"><h2>Using Code Templates</h2> <br><center><img src="images/typesystem-templates.png"></center><br> <table align="center" border="0" cellpadding="2" cellspacing="1" width="100%"><thead><tr class="qt-style" valign="top"><th><center> Node</center></th><th><center> Description</center></th></tr></thead><tr valign="top" class="even"><td> <b>insert-template</b><a name="insert-template"></td><td> The <tt>insert-template</tt> node includes the code template identified by the <tt>name</tt> attribute, and can be a child of the <a href="qtjambi-typesystem.html#inject-code">inject-code</a>, <a href="qtjambi-typesystem.html#conversion-rule">conversion-rule</a>, template, <a href="qtjambi-typesystem.html#custom-constructor">custom-constructor</a> and <a href="qtjambi-typesystem.html#custom-destructor">custom-destructor</a> nodes. For example;<pre> &lt;inject-code class="java" position="beginning"&gt;
     &lt;insert-template name="my_template" /&gt;
 &lt;/inject-code&gt;</pre> Use the <a href="qtjambi-typesystem.html#replace">replace</a> node to modify the template code.</td></tr><tr valign="top" class="odd"><td> <b>replace</b><a name="replace"></td><td> The <tt>replace</tt> node allows you to modify template code before inserting it into the generated code, and can be a child of the <a href="qtjambi-typesystem.html#insert-template">insert-template</a> node.<pre> &lt;insert-template name="my_template"&gt;
     &lt;replace from="..." to="..." /&gt;
 &lt;/insert-template&gt;</pre> Using this node the code specified by the <tt>from</tt> attribute is altered into the code specified by the <tt>to</tt> attribute.</td></tr></table><p /><address><hr /><div align="center">
 <table width="100%" cellspacing="0" border="0"><tr class="address">
 <td width="30%">Copyright &copy; 2009 Nokia Corporation and/or its subsidiary(-ies)</td>
 <td width="40%" align="center"><a href="trademarks.html">Trademarks</a></td>
 <td width="30%" align="right"><div align="right">Qt Jambi 4.5.2_01</div></td>
 </tr></table></div></address></body></html>
