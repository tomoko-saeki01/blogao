<?xml version="1.0" encoding="iso-8859-1"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
<title>Carnet d'Adresses 4 - Éditer et supprimer des adresses</title><link href="classic.css" rel="stylesheet" type="text/css" />
</head><table border="0" cellpadding="0" cellspacing="0" width="100%">
 <tr>
 <td align="left" valign="top" width="32"> <img src="images/qt-logo.png" align="left" width="32" height="32" border="0" /> </td>
 <td width="1">&nbsp;&nbsp;</td> <td class="postheader" valign="center"> <a href="qtjambi-index.html"> <font color="#004faf">Home</font></a>&nbsp;&middot; <a href="qtjambi-examples.html"> <font color="#004faf">Examples</font></a>&nbsp; </td>
 </tr></table><body><p><hr><p><center><h1>Carnet d'Adresses 4 - Éditer et supprimer des adresses</h1></center><p>[Previous: <a href="tutorials-addressbook-fr-part3.html">Carnet d'adresses 3 - Naviguer entre les éléments</a>][<a href="tutorials-addressbook-fr.html">Tutoriel "Carnet d'adresses"</a>][Next: <a href="tutorials-addressbook-fr-part5.html">Carnet d'adresse 5 - Ajouter une fonction de recherche</a>]<p> Dans ce chapitre, nous verrons comment modifier les données des contacts contenus dans l'application carnet d'adresses. <br><center><img src="images/addressbook-tutorial-screenshot.png"></center><br> Nous avons maintenant un carnet d'adresses qui ne se contente pas de lister des contacts de façon ordonnée, mais permet également la navigation. Il serait pratique d'inclure des fonctions telles qu'éditer et supprimer, afin que les détails associés à un contact puissent être modifiés lorsque c'est nécessaire. Cependant, cela requiert une légère modification, sous la forme d'énumérations. Au chapitre précédent, nous avions deux modes: <tt>AddingMode</tt> et <tt>NavigationMode</tt>, mais ils n'étaient pas définis en tant qu'énumérations. Au lieu de ça, on activait et désactivait les boutons correspondants manuellement, au prix de multiples redondances dans le code. <p>Dans ce chapitre, on définit l'énumération <tt>Mode</tt> avec trois valeurs possibles. <ul><li> <tt>NavigationMode</tt>,</li><li> <tt>AddingMode</tt>, et</li><li> <tt>EditingMode</tt>.</li></ul><a name="d-finition-de-la-classe-addressbook"><h2>Définition de la Classe AddressBook</h2> Le fichier <tt>addressbook.h</tt> est mis a jour pour contenir l'énumération <tt>Mode</tt> : <pre class="snippet">
    enum Mode { NavigationMode, AddingMode, EditingMode };
</pre> On ajoute également deux nouveaux slots, <tt>editContact()</tt> et <tt>removeContact()</tt>, à notre liste de slots publics. <pre class="snippet">
    void editContact();
    void removeContact();
</pre> Afin de basculer d'un mode à l'autre, on introduit la méthode <tt>updateInterface()</tt> pour contrôller l'activation et la désactivation de tous les objets <a href="../../../com/trolltech/qt/gui/QPushButton.html">QPushButton</a>. On ajoute également deux nouveaux boutons, <tt>editButton</tt> et <tt>removeButton</tt>, pour les fonctions d'édition et de suppression mentionnées plus haut.Error parsing snippet....    
    QPushButton *editButton;
    QPushButton *removeButton;
...    
    Mode currentMode;
</pre> Enfin, on déclare <tt>currentMode</tt> pour garder une trace du mode actuellement utilisé.<a name="impl-mentation-de-la-classe-addressbook"><h2>Implémentation de la Classe AddressBook</h2> Il nous faut maintenant implémenter les fonctionnalités de changement de mode de l'application carnet d'adresses. Les boutons <tt>editButton</tt> et <tt>removeButton</tt> sont instanciés et désactivés par défaut, puisque le carnet d'adresses démarre sans aucun contact en mémoire.<br><br>The following code example is written in c++.<br> <pre class="snippet"> 
    editButton = new QPushButton(tr("&Edit"));
    editButton-&gt;setEnabled(false);
    removeButton = new QPushButton(tr("&Remove"));
    removeButton-&gt;setEnabled(false);
</pre> Ces boutons sont ensuite connectés à leurs slots respectifs, <tt>editContact()</tt> et <tt>removeContact()</tt>, avant d'être ajoutés à <tt>buttonLayout1</tt>.<br><br>The following code example is written in c++.<br> <pre class="snippet"> 
    connect(editButton, SIGNAL(clicked()), this, SLOT(editContact()));
    connect(removeButton, SIGNAL(clicked()), this, SLOT(removeContact()));
...     
    buttonLayout1-&gt;addWidget(editButton);
    buttonLayout1-&gt;addWidget(removeButton);
</pre> La methode <tt>editContact()</tt> place les anciens détails du contact dans <tt>oldName</tt> et <tt>oldAddress</tt>, avant de basculer vers le mode <tt>EditingMode</tt>. Dans ce mode, les boutons <tt>submitButton</tt> et <tt>cancelButton</tt> sont tous deux activés, l'utilisateur peut par conséquent modifier les détails du contact et cliquer sur l'un de ces deux boutons par la suite.Error parsing snippet.</pre> La méthode <tt>submitContact()</tt> a été divisée en deux avec un bloc <tt>if-else</tt>. On teste <tt>currentMode</tt> pour voir si le mode courant est <tt>AddingMode</tt>. Si c'est le cas, on procède à l'ajout.Error parsing snippet....Error parsing snippet.</pre> Sinon, on s'assure que <tt>currentMode</tt> est en <tt>EditingMode</tt>. Si c'est le cas, on compare <tt>oldName</tt> et <tt>name</tt>. Si le nom a changé, on supprime l'ancien contact de <tt>contacts</tt> et on insère le contact mis a jour.Error parsing snippet.</pre> Si seule l'adresse a changé (i.e. <tt>oldAddress</tt> n'est pas identique à <tt>address</tt>), on met à jour l'adresse du contact. Enfin on règle <tt>currentMode</tt> à <tt>NavigationMode</tt>. C'est une étape importante puisque c'est cela qui réactive tous les boutons désactivés. <p>Afin de retirer un contact du carnet d'adresses, on implémente la méthode <tt>removeContact()</tt>. Cette méthode vérifie que le contact est présent dans <tt>contacts</tt>.Error parsing snippet.</pre> Si c'est le cas, on affiche une boîte de dialogue <a href="../../../com/trolltech/qt/gui/QMessageBox.html">QMessageBox</a>, demandant confirmation de la suppression à l'utilisateur. Une fois la confirmation effectuée, on appelle <tt>previous()</tt>, afin de s'assurer que l'interface utilisateur affiche une autre entrée, et on supprime le contact en utilisant le méthode remove() de QMap. Dans un souci pratique, on informe l'utilisateur de la suppression par le biais d'une autre <a href="../../../com/trolltech/qt/gui/QMessageBox.html">QMessageBox</a>. Les deux boîtes de dialogue utilisées dans cette méthode sont représentées ci-dessous. <br><center><img src="images/addressbook-tutorial-part4-remove.png"></center><br><a name="mise-jour-de-l-interface-utilisateur"><h3>Mise à jour de l'Interface utilisateur</h3> On a évoqué plus haut la méthode <tt>updateInterface()</tt> comme moyen d'activer et de désactiver les différents boutons de l'interface en fonction du mode. Cette méthode met à jour le mode courant après l'argument <tt>mode</tt> qui lui est passé, en l'assignant à <tt>currentMode</tt>, avant de tester sa valeur. <p>Chacun des boutons est ensuite activé ou désactivé, en fonction du mode. Le code source pour les cas <tt>AddingMode</tt> et <tt>EditingMode</tt> est visible ci- dessous:Error parsing snippet.</pre> Dans le cas de <tt>NavigationMode</tt>, en revanche, des tests conditionnels sont passés en paramètre de QPushButton::setEnabled(). Ceci permet de s'assurer que les boutons <tt>editButton</tt> et <tt>removeButton</tt> ne sont activés que s'il existe au moins un contact dans le carnet d'adresses; <tt>nextButton</tt> et <tt>previousButton</tt> ne sont activés que lorsqu'il existe plus d'un contact dans le carnet d'adresses.Error parsing snippet.</pre> En effectuant les opérations de réglage du mode et de mise à jour de l'interface utilisateur au sein de la même méthode, on est à l'abri de l'éventualité où l'interface utilisateur de "désynchronise" de l'état interne de l'application.<p /><address><hr /><div align="center">
 <table width="100%" cellspacing="0" border="0"><tr class="address">
 <td width="30%">Copyright &copy; 2009 Nokia Corporation and/or its subsidiary(-ies)</td>
 <td width="40%" align="center"><a href="trademarks.html">Trademarks</a></td>
 <td width="30%" align="right"><div align="right">Qt Jambi 4.5.2_01</div></td>
 </tr></table></div></address></body></html>
