<?xml version="1.0" encoding="iso-8859-1"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
<title>Address Book 4 - Editing and Removing Addresses</title><link href="classic.css" rel="stylesheet" type="text/css" />
</head><table border="0" cellpadding="0" cellspacing="0" width="100%">
 <tr>
 <td align="left" valign="top" width="32"> <img src="images/qt-logo.png" align="left" width="32" height="32" border="0" /> </td>
 <td width="1">&nbsp;&nbsp;</td> <td class="postheader" valign="center"> <a href="qtjambi-index.html"> <font color="#004faf">Home</font></a>&nbsp;&middot; <a href="qtjambi-examples.html"> <font color="#004faf">Examples</font></a>&nbsp; </td>
 </tr></table><body><p><hr><p><center><h1>Address Book 4 - Editing and Removing Addresses</h1></center><p>[Previous: <a href="tutorials-addressbook-part3.html">Address Book 3 - Navigating between Entries</a>][<a href="tutorials-addressbook.html">Address Book Tutorial</a>][Next: <a href="tutorials-addressbook-part5.html">Address Book 5 - Adding a Find Function</a>]<p> In this chapter, we look at ways to modify the contents of contact stored in the address book application. <br><center><img src="images/addressbook-tutorial-screenshot.png"></center><br> We now have an address book that not only holds contacts in an organized manner, but also allows navigation. It would be convenient to include edit and remove functions so that a contact's details can be changed when needed. However, this requires a little improvement, in the form of enums. In our previous chapters, we had two modes: <tt>AddingMode</tt> and <tt>NavigationMode</tt> - but they weren't defined as enums. Instead, we enabled and disabled the corresponding buttons manually, resulting in multiple lines of repeated code. <p>In this chapter, we define the <tt>Mode</tt> enum with three different values: <ul><li> <tt>NavigationMode</tt>,</li><li> <tt>AddingMode</tt>, and</li><li> <tt>EditingMode</tt>.</li></ul><a name="defining-the-addressbook-class"><h2>Defining the AddressBook Class</h2> The <tt>addressbook.h</tt> file is updated to contain the <tt>Mode</tt> enum: <pre class="snippet">
    enum Mode { NavigationMode, AddingMode, EditingMode };
</pre> We also add two new slots, <tt>editContact()</tt> and <tt>removeContact()</tt>, to our current list of public slots. <pre class="snippet">
    void editContact();
    void removeContact();
</pre> In order to switch between modes, we introduce the <tt>updateInterface()</tt> function to control the enabling and disabling of all <a href="../../../com/trolltech/qt/gui/QPushButton.html">QPushButton</a> objects. We also add two new push buttons, <tt>editButton</tt> and <tt>removeButton</tt>, for the edit and remove functions mentioned earlier.Error parsing snippet....    
    QPushButton *editButton;
    QPushButton *removeButton;
...    
    Mode currentMode;
</pre> Lastly, we declare <tt>currentMode</tt> to keep track of the current mode of the enum.<a name="implementing-the-addressbook-class"><h2>Implementing the AddressBook Class</h2> We now have to implement the mode-changing features of the address book application. The <tt>editButton</tt> and <tt>removeButton</tt> are instantiated and disabled by default, as the address book starts up with zero contacts in memory.<br><br>The following code example is written in c++.<br> <pre class="snippet"> 
    editButton = new QPushButton(tr("&Edit"));
    editButton-&gt;setEnabled(false);
    removeButton = new QPushButton(tr("&Remove"));
    removeButton-&gt;setEnabled(false);
</pre> These buttons are then connected to their respective slots, <tt>editContact()</tt> and <tt>removeContact()</tt>, and we add them to <tt>buttonLayout1</tt>.<br><br>The following code example is written in c++.<br> <pre class="snippet"> 
    connect(editButton, SIGNAL(clicked()), this, SLOT(editContact()));
    connect(removeButton, SIGNAL(clicked()), this, SLOT(removeContact()));
...     
    buttonLayout1-&gt;addWidget(editButton);
    buttonLayout1-&gt;addWidget(removeButton);
</pre> The <tt>editContact()</tt> function stores the contact's old details in <tt>oldName</tt> and <tt>oldAddress</tt>, before switching the mode to <tt>EditingMode</tt>. In this mode, the <tt>submitButton</tt> and <tt>cancelButton</tt> are both enabled, hence, the user can change the contact's details and click either button.Error parsing snippet.</pre> The <tt>submitContact()</tt> function has been divided in two with an <tt>if-else</tt> statement. We check <tt>currentMode</tt> to see if it's in <tt>AddingMode</tt>. If it is, we proceed with our adding process.Error parsing snippet....Error parsing snippet.</pre> Otherwise, we check to see if <tt>currentMode</tt> is in <tt>EditingMode</tt>. If it is, we compare <tt>oldName</tt> with <tt>name</tt>. If the name has changed, we remove the old contact from <tt>contacts</tt> and insert the newly updated contact.Error parsing snippet.</pre> If only the address has changed (i.e., <tt>oldAddress</tt> is not the same as <tt>address</tt>), we update the contact's address. Lastly, we set <tt>currentMode</tt> to <tt>NavigationMode</tt>. This is an important step as it re-enables all the disabled push buttons. <p>To remove a contact from the address book, we implement the <tt>removeContact()</tt> function. This function checks to see if the contact exists in <tt>contacts</tt>.Error parsing snippet.</pre> If it does, we display a <a href="../../../com/trolltech/qt/gui/QMessageBox.html">QMessageBox</a>, to confirm the removal with the user. Once the user has confirmed, we call <tt>previous()</tt> to ensure that the user interface shows another contact, and we remove the contact using QMap's remove() function. As a courtesy, we display a <a href="../../../com/trolltech/qt/gui/QMessageBox.html">QMessageBox</a> to inform the user. Both the message boxes used in this function are shown below: <br><center><img src="images/addressbook-tutorial-part4-remove.png"></center><br><a name="updating-the-user-interface"><h3>Updating the User Interface</h3> We mentioned the <tt>updateInterface()</tt> function earlier as a means to enable and disable the push buttons depending on the current mode. The function updates the current mode according to the <tt>mode</tt> argument passed to it, assigning it to <tt>currentMode</tt> before checking its value. <p>Each of the push buttons is then enabled or disabled, depending on the current mode. The code for <tt>AddingMode</tt> and <tt>EditingMode</tt> is shown below:Error parsing snippet.</pre> For <tt>NavigationMode</tt>, however, we include conditions within the parameters of the QPushButton::setEnabled(). This is to ensure that the <tt>editButton</tt> and <tt>removeButton</tt> push buttons are enabled when there is at least one contact in the address book; <tt>nextButton</tt> and <tt>previousButton</tt> are only enabled when there is more than one contact in the address book.Error parsing snippet.</pre> By performing the task of setting the mode and updating the user interface in the same function, we avoid the possibility of the user interface getting "out of sync" with the internal state of the application.<p /><address><hr /><div align="center">
 <table width="100%" cellspacing="0" border="0"><tr class="address">
 <td width="30%">Copyright &copy; 2009 Nokia Corporation and/or its subsidiary(-ies)</td>
 <td width="40%" align="center"><a href="trademarks.html">Trademarks</a></td>
 <td width="30%" align="right"><div align="right">Qt Jambi 4.5.2_01</div></td>
 </tr></table></div></address></body></html>
